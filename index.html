<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PatioControl Pro - Sistema Avançado de Controle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #5a67d8, #6b46c1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-morphism {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .dark .card-hover:hover {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .border-gradient {
            border: 2px solid;
            border-image: linear-gradient(135deg, #667eea, #764ba2) 1;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
            transform: translateY(-5px) scale(1.05);
        }
        
        .dark .stat-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .dark .stat-card:hover {
            background: linear-gradient(135deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.2) 100%);
        }
        
        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(2.4);
                opacity: 0;
            }
        }
        
        .table-modern {
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .table-row-modern {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .table-row-modern::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .table-row-modern:hover::before {
            transform: scaleY(1);
        }
        
        .table-row-modern:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05), transparent);
            transform: translateX(8px);
        }
        
        .dark .table-row-modern:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1), transparent);
        }
        
        .floating-action {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
            animation: float 3s ease-in-out infinite;
        }
        
        .tab-modern {
            position: relative;
            overflow: hidden;
        }
        
        .tab-modern::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }
        
        .tab-modern.active::after {
            width: 100%;
        }
        
        .tab-modern:hover::after {
            width: 60%;
        }
        
        .chart-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .dark .chart-container {
            background: linear-gradient(135deg, rgba(17,24,39,0.95) 0%, rgba(17,24,39,0.9) 100%);
            border: 1px solid rgba(75,85,99,0.3);
        }
        
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .dark .loading-shimmer {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
        }
        
        @media print {
            .no-print { display: none !important; }
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        
        .success-glow {
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }
        
        .error-glow {
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }
        
        .warning-glow {
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
        }
        
        .info-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- Hero Header -->
    <header class="hero-gradient relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-20"></div>
        <!-- Animated background pattern -->
        <div class="absolute inset-0 opacity-10">
            <div class="absolute top-0 left-0 w-64 h-64 bg-white rounded-full mix-blend-multiply filter blur-xl animate-float"></div>
            <div class="absolute top-0 right-0 w-64 h-64 bg-white rounded-full mix-blend-multiply filter blur-xl animate-float" style="animation-delay: 2s;"></div>
            <div class="absolute bottom-0 left-1/2 w-64 h-64 bg-white rounded-full mix-blend-multiply filter blur-xl animate-float" style="animation-delay: 4s;"></div>
        </div>
        
        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center">
                    <div class="relative">
                        <div class="absolute -inset-1 bg-white rounded-full pulse-ring opacity-30"></div>
                        <div class="relative bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg p-3 rounded-full">
                            <i class="fas fa-truck text-2xl text-white"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h1 class="text-2xl font-bold text-white tracking-tight">
                            Sistema de Controle
                        </h1>
                        <p class="text-blue-100 text-sm font-medium">Tempo de Pátio & Palha</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="glass-morphism rounded-lg px-4 py-2">
                        <div class="flex items-center text-white">
                            <i class="fas fa-clock mr-2 text-blue-200"></i>
                            <span class="text-sm font-medium" id="current-date"></span>
                        </div>
                    </div>
                    <div class="glass-morphism rounded-full p-2">
                        <i class="fas fa-bell text-white text-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40 backdrop-blur-md bg-opacity-90 dark:bg-opacity-90">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="flex space-x-2 overflow-x-auto">
                <button class="tab-btn tab-modern active py-4 px-6 border-b-2 border-indigo-500 text-indigo-600 dark:text-indigo-400 font-semibold text-sm whitespace-nowrap" data-tab="entrada">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-plus-circle text-lg"></i>
                        <span>Entrada de Dados</span>
                    </div>
                </button>
                <button class="tab-btn tab-modern py-4 px-6 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 font-semibold text-sm whitespace-nowrap transition-all duration-300" data-tab="visualizar">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-table text-lg"></i>
                        <span>Visualizar Dados</span>
                    </div>
                </button>
                <button class="tab-btn tab-modern py-4 px-6 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 font-semibold text-sm whitespace-nowrap transition-all duration-300" data-tab="dashboard">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-tachometer-alt text-lg"></i>
                        <span>Dashboard</span>
                    </div>
                </button>
                <button class="tab-btn tab-modern py-4 px-6 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 font-semibold text-sm whitespace-nowrap transition-all duration-300" data-tab="relatorios">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-chart-bar text-lg"></i>
                        <span>Relatórios</span>
                    </div>
                </button>
                <button class="tab-btn tab-modern py-4 px-6 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 font-semibold text-sm whitespace-nowrap transition-all duration-300" data-tab="configuracoes">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-cog text-lg"></i>
                        <span>Configurações</span>
                    </div>
                </button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Entrada de Dados Tab -->
        <div id="entrada-tab" class="tab-content">
            <!-- Header com modo de entrada -->
            <div class="chart-container shadow-2xl rounded-3xl p-6 mb-8 card-hover">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                    <div class="flex items-center">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full blur-sm opacity-75"></div>
                            <div class="relative bg-white dark:bg-gray-800 p-3 rounded-full">
                                <i class="fas fa-plus-circle text-2xl text-gradient"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <h2 class="text-2xl font-bold text-gradient">Entrada de Dados Inteligente</h2>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Registro otimizado com validação em tempo real</p>
                        </div>
                    </div>
                    
                    <!-- Modo de entrada -->
                    <div class="flex flex-wrap gap-4">
                        <div class="flex bg-gray-100 dark:bg-gray-700 rounded-xl p-1">
                            <button id="modo-simples" class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm">
                                <i class="fas fa-edit mr-2"></i>Simples
                            </button>
                            <button id="modo-wizard" class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 text-gray-600 dark:text-gray-400">
                                <i class="fas fa-magic mr-2"></i>Assistido
                            </button>
                            <button id="modo-rapido" class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 text-gray-600 dark:text-gray-400">
                                <i class="fas fa-bolt mr-2"></i>Rápido
                            </button>
                        </div>
                        <button id="import-quick" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl text-sm shadow-lg">
                            <i class="fas fa-file-import mr-2"></i>Importar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Estatísticas rápidas -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="stat-card p-4 rounded-2xl card-hover">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-day text-blue-500 text-xl mr-3"></i>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wider">Hoje</p>
                            <p id="quick-stats-today" class="text-xl font-bold text-gray-900 dark:text-white">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-4 rounded-2xl card-hover">
                    <div class="flex items-center">
                        <i class="fas fa-truck text-green-500 text-xl mr-3"></i>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wider">Último</p>
                            <p id="quick-stats-last" class="text-lg font-bold text-gray-900 dark:text-white">-</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-4 rounded-2xl card-hover">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-purple-500 text-xl mr-3"></i>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wider">Média Hoje</p>
                            <p id="quick-stats-avg" class="text-lg font-bold text-gray-900 dark:text-white">0 min</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-4 rounded-2xl card-hover">
                    <div class="flex items-center">
                        <i class="fas fa-tachometer-alt text-orange-500 text-xl mr-3"></i>
                        <div>
                            <p class="text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wider">Status</p>
                            <p id="quick-stats-status" class="text-lg font-bold text-green-600 dark:text-green-400">OK</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Entrada Simples -->
            <div id="entrada-simples" class="entrada-mode">
                <div class="chart-container shadow-2xl rounded-3xl p-8 card-hover">
                    <!-- Progress bar -->
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Progresso do Formulário</span>
                            <span id="form-progress-text" class="text-sm text-gray-600 dark:text-gray-400">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div id="form-progress-bar" class="bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>

                    <form id="data-form" class="space-y-8">
                        <!-- Informações Básicas -->
                        <div class="form-section">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                Informações Básicas
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        <i class="fas fa-industry mr-1"></i>Usina
                                    </label>
                                    <input type="text" id="usina" value="4 CAMBUI" 
                                           class="form-input w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 text-base px-4 py-3 transition-all duration-200">
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        <i class="fas fa-truck mr-1"></i>Caminhão *
                                    </label>
                                    <div class="relative">
                                        <input type="text" id="caminhao" required autocomplete="off"
                                               class="form-input w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 text-base px-4 py-3 transition-all duration-200"
                                               placeholder="Digite o código do caminhão">
                                        <div id="caminhao-suggestions" class="absolute z-10 w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-xl mt-1 max-h-60 overflow-y-auto hidden shadow-lg">
                                            <!-- Sugestões aparecerão aqui -->
                                        </div>
                                    </div>
                                    <div class="mt-1 flex items-center">
                                        <i id="caminhao-status" class="fas fa-circle text-gray-400 text-xs mr-2"></i>
                                        <span id="caminhao-feedback" class="text-xs text-gray-500">Digite para ver sugestões</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        <i class="fas fa-road mr-1"></i>Frente Saída *
                                    </label>
                                    <select id="frente-saida" required
                                            class="form-input w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 text-base px-4 py-3 transition-all duration-200">
                                        <option value="">Selecione a frente...</option>
                                    </select>
                                    <div class="mt-1 flex items-center">
                                        <i id="frente-status" class="fas fa-circle text-gray-400 text-xs mr-2"></i>
                                        <span id="frente-feedback" class="text-xs text-gray-500">Selecione uma frente</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Horários -->
                        <div class="form-section">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                                <i class="fas fa-clock text-green-500 mr-2"></i>
                                Horários de Operação
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        <i class="fas fa-play text-blue-500 mr-1"></i>Saída Central *
                                    </label>
                                    <input type="datetime-local" id="saida-central" required
                                           class="form-input w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 text-base px-4 py-3 transition-all duration-200">
                                    <div class="mt-1 flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i id="saida-central-status" class="fas fa-circle text-gray-400 text-xs mr-2"></i>
                                            <span id="saida-central-feedback" class="text-xs text-gray-500">Informe data e hora</span>
                                        </div>
                                        <button type="button" id="btn-agora-saida" class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400">Agora</button>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        <i class="fas fa-arrow-down text-orange-500 mr-1"></i>Chegada Palha *
                                    </label>
                                    <input type="datetime-local" id="chegada-palha" required
                                           class="form-input w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 text-base px-4 py-3 transition-all duration-200">
                                    <div class="mt-1 flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i id="chegada-palha-status" class="fas fa-circle text-gray-400 text-xs mr-2"></i>
                                            <span id="chegada-palha-feedback" class="text-xs text-gray-500">Informe data e hora</span>
                                        </div>
                                        <button type="button" id="btn-agora-chegada-palha" class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400">Agora</button>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        <i class="fas fa-arrow-up text-purple-500 mr-1"></i>Saída Palha *
                                    </label>
                                    <input type="datetime-local" id="saida-palha" required
                                           class="form-input w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 text-base px-4 py-3 transition-all duration-200">
                                    <div class="mt-1 flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i id="saida-palha-status" class="fas fa-circle text-gray-400 text-xs mr-2"></i>
                                            <span id="saida-palha-feedback" class="text-xs text-gray-500">Informe data e hora</span>
                                        </div>
                                        <button type="button" id="btn-agora-saida-palha" class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400">Agora</button>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        <i class="fas fa-arrow-down text-teal-500 mr-1"></i>Chegada Usina *
                                    </label>
                                    <input type="datetime-local" id="chegada-usina" required
                                           class="form-input w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 text-base px-4 py-3 transition-all duration-200">
                                    <div class="mt-1 flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i id="chegada-usina-status" class="fas fa-circle text-gray-400 text-xs mr-2"></i>
                                            <span id="chegada-usina-feedback" class="text-xs text-gray-500">Informe data e hora</span>
                                        </div>
                                        <button type="button" id="btn-agora-chegada-usina" class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400">Agora</button>
                                    </div>
                                </div>

                                <div class="md:col-span-2 lg:col-span-4">
                                    <div class="form-group">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            <i class="fas fa-stop text-red-500 mr-1"></i>Saída Pesagem *
                                        </label>
                                        <input type="datetime-local" id="saida-pesagem" required
                                               class="form-input w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500 text-base px-4 py-3 transition-all duration-200">
                                        <div class="mt-1 flex items-center justify-between">
                                            <div class="flex items-center">
                                                <i id="saida-pesagem-status" class="fas fa-circle text-gray-400 text-xs mr-2"></i>
                                                <span id="saida-pesagem-feedback" class="text-xs text-gray-500">Informe data e hora</span>
                                            </div>
                                            <button type="button" id="btn-agora-saida-pesagem" class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400">Agora</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Preview dos Tempos -->
                        <div id="tempos-preview" class="form-section bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 p-6 rounded-2xl">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                <i class="fas fa-calculator text-green-500 mr-2"></i>
                                Tempos Calculados
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mr-4">
                                            <i class="fas fa-clock text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Tempo de Palha</p>
                                            <p id="tempo-palha-calc" class="text-2xl font-bold text-gray-900 dark:text-white">-- min</p>
                                        </div>
                                    </div>
                                    <div id="tempo-palha-status" class="text-right">
                                        <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                                            Aguardando
                                        </span>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mr-4">
                                            <i class="fas fa-chart-line text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Tempo de Pátio</p>
                                            <p id="tempo-patio-calc" class="text-2xl font-bold text-gray-900 dark:text-white">-- min</p>
                                        </div>
                                    </div>
                                    <div id="tempo-patio-status" class="text-right">
                                        <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                                            Aguardando
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Alertas -->
                            <div id="tempo-alerts" class="mt-4 space-y-2">
                                <!-- Alertas aparecerão aqui -->
                            </div>
                        </div>

                        <!-- Botões de Ação -->
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button type="submit" id="btn-salvar" disabled
                                    class="flex-1 btn-primary text-white font-semibold py-4 px-8 rounded-2xl text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300">
                                <i class="fas fa-save mr-3"></i>Salvar Entrada
                            </button>
                            <button type="button" id="duplicate-last"
                                    class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-4 px-8 rounded-2xl text-lg shadow-lg transition-all duration-300 hover:transform hover:scale-105">
                                <i class="fas fa-copy mr-3"></i>Duplicar Último
                            </button>
                            <button type="button" id="clear-form"
                                    class="bg-gradient-to-r from-gray-400 to-gray-600 hover:from-gray-500 hover:to-gray-700 text-white font-semibold py-4 px-8 rounded-2xl text-lg shadow-lg transition-all duration-300 hover:transform hover:scale-105">
                                <i class="fas fa-eraser mr-3"></i>Limpar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Entrada Wizard -->
            <div id="entrada-wizard" class="entrada-mode hidden">
                <div class="chart-container shadow-2xl rounded-3xl p-8 card-hover">
                    <!-- Wizard Steps -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="wizard-step active" data-step="1">
                                    <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold">1</div>
                                    <span class="mt-2 text-sm font-medium">Básico</span>
                                </div>
                                <div class="flex-1 h-0.5 bg-gray-300 dark:bg-gray-600"></div>
                                <div class="wizard-step" data-step="2">
                                    <div class="w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 flex items-center justify-center font-bold">2</div>
                                    <span class="mt-2 text-sm font-medium text-gray-600 dark:text-gray-400">Horários</span>
                                </div>
                                <div class="flex-1 h-0.5 bg-gray-300 dark:bg-gray-600"></div>
                                <div class="wizard-step" data-step="3">
                                    <div class="w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 flex items-center justify-center font-bold">3</div>
                                    <span class="mt-2 text-sm font-medium text-gray-600 dark:text-gray-400">Revisão</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Wizard Content -->
                    <div id="wizard-content">
                        <!-- Step 1 -->
                        <div id="wizard-step-1" class="wizard-step-content">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Informações Básicas</h3>
                            <!-- Conteúdo do step 1 -->
                        </div>
                        <!-- Step 2 -->
                        <div id="wizard-step-2" class="wizard-step-content hidden">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Horários de Operação</h3>
                            <!-- Conteúdo do step 2 -->
                        </div>
                        <!-- Step 3 -->
                        <div id="wizard-step-3" class="wizard-step-content hidden">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Revisão e Confirmação</h3>
                            <!-- Conteúdo do step 3 -->
                        </div>
                    </div>

                    <!-- Wizard Navigation -->
                    <div class="flex justify-between mt-8">
                        <button id="wizard-prev" class="px-6 py-3 bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 rounded-xl font-medium disabled:opacity-50" disabled>
                            <i class="fas fa-arrow-left mr-2"></i>Anterior
                        </button>
                        <button id="wizard-next" class="px-6 py-3 btn-primary text-white rounded-xl font-medium">
                            Próximo<i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Entrada Rápida -->
            <div id="entrada-rapida" class="entrada-mode hidden">
                <div class="chart-container shadow-2xl rounded-3xl p-8 card-hover">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                        <i class="fas fa-bolt text-yellow-500 mr-2"></i>
                        Entrada Rápida
                    </h3>
                    
                    <!-- Template de entrada rápida -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                        <input type="text" id="quick-caminhao" placeholder="Caminhão" class="form-input rounded-xl px-4 py-3">
                        <select id="quick-frente" class="form-input rounded-xl px-4 py-3">
                            <option value="">Frente</option>
                        </select>
                        <input type="time" id="quick-inicio" class="form-input rounded-xl px-4 py-3">
                        <input type="number" id="quick-tempo-palha" placeholder="Tempo Palha (min)" class="form-input rounded-xl px-4 py-3">
                        <input type="number" id="quick-tempo-patio" placeholder="Tempo Pátio (min)" class="form-input rounded-xl px-4 py-3">
                        <button id="btn-salvar-rapido" class="btn-primary text-white rounded-xl px-4 py-3 font-medium">
                            <i class="fas fa-plus mr-2"></i>Adicionar
                        </button>
                    </div>

                    <!-- Lista de entradas em lote -->
                    <div id="entradas-lote" class="space-y-2 max-h-64 overflow-y-auto">
                        <!-- Entradas em lote aparecerão aqui -->
                    </div>

                    <div class="flex gap-4 mt-6">
                        <button id="btn-salvar-lote" class="flex-1 btn-primary text-white rounded-xl py-3 font-medium">
                            <i class="fas fa-save mr-2"></i>Salvar Todos
                        </button>
                        <button id="btn-limpar-lote" class="px-6 py-3 bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 rounded-xl font-medium">
                            <i class="fas fa-trash mr-2"></i>Limpar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Histórico Recente -->
            <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-history text-blue-500 mr-2"></i>
                        Últimos Registros
                    </h3>
                    <button id="refresh-recent" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm">
                        <i class="fas fa-sync-alt mr-1"></i>Atualizar
                    </button>
                </div>
                <div id="recent-entries" class="space-y-3 max-h-64 overflow-y-auto">
                    <!-- Entradas recentes aparecerão aqui -->
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content hidden">
            <!-- Dashboard Header with Filters -->
            <div class="chart-container shadow-2xl rounded-3xl p-6 mb-8 card-hover">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                    <div class="flex items-center">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full blur-sm opacity-75"></div>
                            <div class="relative bg-white dark:bg-gray-800 p-3 rounded-full">
                                <i class="fas fa-tachometer-alt text-2xl text-gradient"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <h2 class="text-2xl font-bold text-gradient">Dashboard Analytics</h2>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Visão completa dos tempos e performance</p>
                        </div>
                    </div>
                    
                    <!-- Dashboard Filters -->
                    <div class="flex flex-wrap gap-4">
                        <select id="dashboard-period" class="px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-indigo-500 text-sm">
                            <option value="7">Últimos 7 dias</option>
                            <option value="30">Últimos 30 dias</option>
                            <option value="90">Últimos 90 dias</option>
                            <option value="all">Todos os dados</option>
                        </select>
                        <button id="refresh-dashboard" class="btn-primary text-white px-4 py-2 rounded-xl text-sm shadow-lg">
                            <i class="fas fa-sync-alt mr-2"></i>Atualizar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Advanced KPI Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-6 mb-8">
                <!-- Registros Hoje -->
                <div class="stat-card p-6 rounded-3xl card-hover animate-float">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-blue-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-blue-500 to-blue-600 p-3 rounded-full">
                                <i class="fas fa-calendar-day text-white text-lg"></i>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-gray-600 dark:text-gray-400 text-xs font-medium uppercase tracking-wider">Hoje</p>
                            <p id="kpi-today" class="text-3xl font-bold text-gray-900 dark:text-white">0</p>
                            <p id="kpi-today-change" class="text-xs font-medium">-</p>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div id="kpi-today-progress" class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Total Registros -->
                <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.1s;">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-green-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-full">
                                <i class="fas fa-database text-white text-lg"></i>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-gray-600 dark:text-gray-400 text-xs font-medium uppercase tracking-wider">Total</p>
                            <p id="kpi-total" class="text-3xl font-bold text-gray-900 dark:text-white">0</p>
                            <p id="kpi-total-info" class="text-xs text-gray-500 dark:text-gray-400">registros</p>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div class="bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full transition-all duration-500" style="width: 100%"></div>
                    </div>
                </div>

                <!-- Média Palha -->
                <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.2s;">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-purple-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-purple-500 to-purple-600 p-3 rounded-full">
                                <i class="fas fa-clock text-white text-lg"></i>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-gray-600 dark:text-gray-400 text-xs font-medium uppercase tracking-wider">Palha</p>
                            <p id="kpi-avg-palha" class="text-3xl font-bold text-gray-900 dark:text-white">0min</p>
                            <p id="kpi-palha-status" class="text-xs font-medium">-</p>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div id="kpi-palha-progress" class="bg-gradient-to-r from-purple-500 to-purple-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Média Pátio -->
                <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.3s;">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-orange-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-orange-500 to-orange-600 p-3 rounded-full">
                                <i class="fas fa-chart-line text-white text-lg"></i>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-gray-600 dark:text-gray-400 text-xs font-medium uppercase tracking-wider">Pátio</p>
                            <p id="kpi-avg-patio" class="text-3xl font-bold text-gray-900 dark:text-white">0min</p>
                            <p id="kpi-patio-status" class="text-xs font-medium">-</p>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div id="kpi-patio-progress" class="bg-gradient-to-r from-orange-500 to-orange-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Eficiência -->
                <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.4s;">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-indigo-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-indigo-500 to-indigo-600 p-3 rounded-full">
                                <i class="fas fa-tachometer-alt text-white text-lg"></i>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-gray-600 dark:text-gray-400 text-xs font-medium uppercase tracking-wider">Eficiência</p>
                            <p id="kpi-efficiency" class="text-3xl font-bold text-gray-900 dark:text-white">0%</p>
                            <p id="kpi-efficiency-status" class="text-xs font-medium">-</p>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div id="kpi-efficiency-progress" class="bg-gradient-to-r from-indigo-500 to-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Frentes Ativas -->
                <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.5s;">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-teal-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-teal-500 to-teal-600 p-3 rounded-full">
                                <i class="fas fa-road text-white text-lg"></i>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-gray-600 dark:text-gray-400 text-xs font-medium uppercase tracking-wider">Frentes</p>
                            <p id="kpi-frentes-ativas" class="text-3xl font-bold text-gray-900 dark:text-white">0</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">ativas</p>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div id="kpi-frentes-progress" class="bg-gradient-to-r from-teal-500 to-teal-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Performance Alerts -->
            <div id="performance-alerts" class="mb-8">
                <!-- Alertas serão inseridos aqui dinamicamente -->
            </div>

            <!-- Charts Row 1 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Tempo Médio por Frente -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-chart-bar mr-2 text-blue-600"></i>Tempo Médio por Frente
                    </h3>
                    <div class="h-80">
                        <canvas id="chart-frente"></canvas>
                    </div>
                </div>

                <!-- Distribuição por Turno -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-pie-chart mr-2 text-green-600"></i>Distribuição por Turno
                    </h3>
                    <div class="h-80">
                        <canvas id="chart-turno"></canvas>
                    </div>
                </div>
            </div>

            <!-- Charts Row 2 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Evolução Temporal -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-chart-line mr-2 text-purple-600"></i>Evolução Temporal (Últimos 7 dias)
                    </h3>
                    <div class="h-80">
                        <canvas id="chart-evolution"></canvas>
                    </div>
                </div>

                <!-- Comparativo Palha vs Pátio -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-balance-scale mr-2 text-yellow-600"></i>Comparativo Palha vs Pátio
                    </h3>
                    <div class="h-80">
                        <canvas id="chart-comparison"></canvas>
                    </div>
                </div>
            </div>

            <!-- Charts Row 3 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Histograma de Tempos -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-chart-area mr-2 text-red-600"></i>Distribuição de Tempos (Palha)
                    </h3>
                    <div class="h-80">
                        <canvas id="chart-histogram"></canvas>
                    </div>
                </div>

                <!-- Performance por Caminhão -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-truck mr-2 text-indigo-600"></i>Top 10 Caminhões (Tempo Médio)
                    </h3>
                    <div class="h-80 overflow-y-auto">
                        <canvas id="chart-trucks"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Visualizar Dados Tab -->
        <div id="visualizar-tab" class="tab-content hidden">
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 gap-4">
                    <h2 class="text-lg font-medium text-gray-900 dark:text-white">
                        <i class="fas fa-table mr-2 text-indigo-600"></i>Dados Registrados
                    </h2>
                    
                    <!-- Advanced Filters -->
                    <div class="flex flex-col sm:flex-row gap-4 w-full lg:w-auto">
                        <!-- Search Bar -->
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="search-input" placeholder="Buscar caminhão..." 
                                   class="pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm w-full sm:w-64">
                        </div>
                        
                        <!-- Date Range Filter -->
                        <div class="flex gap-2">
                            <input type="date" id="date-from" 
                                   class="px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                            <input type="date" id="date-to" 
                                   class="px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                        </div>
                        
                        <!-- Frente Filter -->
                        <select id="frente-filter" 
                                class="px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                            <option value="">Todas as Frentes</option>
                            <option value="4001">4001</option>
                            <option value="4002">4002</option>
                            <option value="4009">4009</option>
                            <option value="4010">4010</option>
                        </select>
                        
                        <!-- Clear Filters -->
                        <button id="clear-filters" 
                                class="px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md transition duration-150 ease-in-out text-sm whitespace-nowrap">
                            <i class="fas fa-times mr-1"></i>Limpar
                        </button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <button id="import-data" 
                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-150 ease-in-out text-sm">
                        <i class="fas fa-upload mr-2"></i>Importar Excel/CSV
                    </button>
                    <div class="relative inline-block">
                        <button id="export-dropdown-btn" 
                                class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-150 ease-in-out text-sm flex items-center">
                            <i class="fas fa-download mr-2"></i>Exportar
                            <i class="fas fa-chevron-down ml-2"></i>
                        </button>
                        <div id="export-dropdown" class="absolute left-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50 hidden">
                            <button id="export-csv-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-md">
                                <i class="fas fa-file-csv mr-2"></i>Exportar CSV
                            </button>
                            <button id="export-excel-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i class="fas fa-file-excel mr-2"></i>Exportar Excel
                            </button>
                            <button id="export-pdf-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-md">
                                <i class="fas fa-file-pdf mr-2"></i>Exportar PDF
                            </button>
                        </div>
                    </div>
                    <button id="backup-data" 
                            class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-md transition duration-150 ease-in-out text-sm">
                        <i class="fas fa-save mr-2"></i>Backup
                    </button>
                    <button id="restore-data" 
                            class="bg-orange-600 hover:bg-orange-700 text-white font-medium py-2 px-4 rounded-md transition duration-150 ease-in-out text-sm">
                        <i class="fas fa-upload mr-2"></i>Restaurar
                    </button>
                    <button id="clear-all-data" 
                            class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md transition duration-150 ease-in-out text-sm">
                        <i class="fas fa-trash mr-2"></i>Limpar Todos
                    </button>
                </div>

                <!-- Stats Summary -->
                <div id="filter-stats" class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6">
                    <div class="flex flex-wrap items-center gap-6 text-sm">
                        <div class="flex items-center">
                            <i class="fas fa-list text-blue-600 mr-2"></i>
                            <span class="text-gray-600 dark:text-gray-400">Registros exibidos:</span>
                            <span id="filtered-count" class="font-semibold text-blue-600 dark:text-blue-400 ml-1">0</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-clock text-green-600 mr-2"></i>
                            <span class="text-gray-600 dark:text-gray-400">Média Palha:</span>
                            <span id="filtered-avg-palha" class="font-semibold text-green-600 dark:text-green-400 ml-1">0 min</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-chart-line text-purple-600 mr-2"></i>
                            <span class="text-gray-600 dark:text-gray-400">Média Pátio:</span>
                            <span id="filtered-avg-patio" class="font-semibold text-purple-600 dark:text-purple-400 ml-1">0 min</span>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto custom-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-700">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Usina</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Caminhão</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Saída Central</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Chegada Palha</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Saída Palha</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tempo Palha (min)</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Chegada Usina</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Saída Pesagem</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tempo Usina (min)</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frente</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider no-print">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="data-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div id="no-data" class="text-center py-8 text-gray-500 dark:text-gray-400 hidden">
                    <i class="fas fa-inbox text-4xl mb-4"></i>
                    <p>Nenhum dado registrado ainda</p>
                </div>
            </div>
        </div>

        <!-- Relatórios Tab -->
        <div id="relatorios-tab" class="tab-content hidden">
            <!-- Reports Header with Controls -->
            <div class="chart-container shadow-2xl rounded-3xl p-6 mb-8 card-hover">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                    <div class="flex items-center">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-gradient-to-r from-green-600 to-blue-600 rounded-full blur-sm opacity-75"></div>
                            <div class="relative bg-white dark:bg-gray-800 p-3 rounded-full">
                                <i class="fas fa-chart-line text-2xl text-gradient"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <h2 class="text-2xl font-bold text-gradient">Relatórios Avançados</h2>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Análise detalhada de performance por frente e turno</p>
                        </div>
                    </div>
                    
                    <!-- Reports Controls -->
                    <div class="flex flex-wrap gap-4">
                        <select id="report-period" class="px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-indigo-500 text-sm">
                            <option value="7">Últimos 7 dias</option>
                            <option value="30">Últimos 30 dias</option>
                            <option value="90">Últimos 90 dias</option>
                            <option value="all">Todo o período</option>
                        </select>
                        <select id="report-type" class="px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-indigo-500 text-sm">
                            <option value="detailed">Relatório Detalhado</option>
                            <option value="summary">Resumo Executivo</option>
                            <option value="comparison">Análise Comparativa</option>
                            <option value="performance">Performance & KPIs</option>
                        </select>
                        <button id="export-report" class="btn-primary text-white px-4 py-2 rounded-xl text-sm shadow-lg">
                            <i class="fas fa-file-export mr-2"></i>Exportar PDF
                        </button>
                        <button id="refresh-reports" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-xl text-sm shadow-lg transition-all duration-300">
                            <i class="fas fa-sync-alt mr-2"></i>Atualizar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Executive Summary Cards -->
            <div id="executive-summary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Cards serão gerados dinamicamente -->
            </div>

            <!-- Main Reports Container -->
            <div id="reports-container">
                <!-- Detailed Reports View -->
                <div id="detailed-reports" class="report-view">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                        <!-- Performance Overview -->
                        <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gradient">Performance Overview</h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Palha</span>
                                    <div class="w-3 h-3 bg-green-500 rounded-full ml-4"></div>
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Pátio</span>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="report-performance-chart"></canvas>
                            </div>
                        </div>

                        <!-- Efficiency Trends -->
                        <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gradient">Tendência de Eficiência</h3>
                                <div class="text-sm text-gray-600 dark:text-gray-400">% Dentro dos Limites</div>
                            </div>
                            <div class="h-80">
                                <canvas id="report-efficiency-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Front Reports -->
                    <div id="front-reports-grid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                        <!-- Reports por frente serão gerados dinamicamente -->
                    </div>
                </div>

                <!-- Summary Reports View -->
                <div id="summary-reports" class="report-view hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- KPI Summary -->
                        <div class="chart-container shadow-2xl rounded-3xl p-8 card-hover">
                            <h3 class="text-xl font-bold text-gradient mb-6">KPIs Principais</h3>
                            <div id="kpi-summary-content" class="space-y-6">
                                <!-- KPI content will be populated -->
                            </div>
                        </div>

                        <!-- Critical Insights -->
                        <div class="chart-container shadow-2xl rounded-3xl p-8 card-hover">
                            <h3 class="text-xl font-bold text-gradient mb-6">Insights Críticos</h3>
                            <div id="critical-insights-content" class="space-y-4">
                                <!-- Insights content will be populated -->
                            </div>
                        </div>
                    </div>

                    <!-- Recommendations -->
                    <div class="mt-8 chart-container shadow-2xl rounded-3xl p-8 card-hover">
                        <h3 class="text-xl font-bold text-gradient mb-6">Recomendações Estratégicas</h3>
                        <div id="recommendations-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Recommendations will be populated -->
                        </div>
                    </div>
                </div>

                <!-- Comparison Reports View -->
                <div id="comparison-reports" class="report-view hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <!-- Front Comparison -->
                        <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                            <h3 class="text-xl font-bold text-gradient mb-6">Comparação entre Frentes</h3>
                            <div class="h-80">
                                <canvas id="report-front-comparison-chart"></canvas>
                            </div>
                        </div>

                        <!-- Shift Analysis -->
                        <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                            <h3 class="text-xl font-bold text-gradient mb-6">Análise por Turno</h3>
                            <div class="h-80">
                                <canvas id="report-shift-analysis-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Comparison Table -->
                    <div class="chart-container shadow-2xl rounded-3xl p-8 card-hover">
                        <h3 class="text-xl font-bold text-gradient mb-6">Tabela Comparativa Detalhada</h3>
                        <div class="overflow-x-auto">
                            <table id="comparison-table" class="w-full">
                                <thead class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">Frente</th>
                                        <th class="px-4 py-3 text-center text-sm font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                        <th class="px-4 py-3 text-center text-sm font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">Tempo Palha</th>
                                        <th class="px-4 py-3 text-center text-sm font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">Tempo Pátio</th>
                                        <th class="px-4 py-3 text-center text-sm font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">Eficiência</th>
                                        <th class="px-4 py-3 text-center text-sm font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="comparison-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Table content will be populated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Performance Reports View -->
                <div id="performance-reports" class="report-view hidden">
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
                        <!-- Performance Gauge -->
                        <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                            <h3 class="text-xl font-bold text-gradient mb-6 text-center">Score Geral</h3>
                            <div class="h-64 flex items-center justify-center">
                                <div id="performance-gauge" class="relative">
                                    <!-- Gauge will be created here -->
                                </div>
                            </div>
                        </div>

                        <!-- Top Performers -->
                        <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                            <h3 class="text-xl font-bold text-gradient mb-6">Top Performers</h3>
                            <div id="top-performers-list" class="space-y-4">
                                <!-- Top performers will be listed here -->
                            </div>
                        </div>

                        <!-- Improvement Areas -->
                        <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                            <h3 class="text-xl font-bold text-gradient mb-6">Áreas de Melhoria</h3>
                            <div id="improvement-areas-list" class="space-y-4">
                                <!-- Improvement areas will be listed here -->
                            </div>
                        </div>
                    </div>

                    <!-- Detailed KPI Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <div class="stat-card p-6 rounded-3xl card-hover animate-float">
                            <div class="text-center">
                                <div class="relative inline-block mb-4">
                                    <div class="absolute -inset-1 bg-blue-500 rounded-full pulse-ring opacity-30"></div>
                                    <div class="relative bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-full">
                                        <i class="fas fa-stopwatch text-white text-2xl"></i>
                                    </div>
                                </div>
                                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2">Tempo Médio Total</h4>
                                <p id="perf-avg-total" class="text-3xl font-bold text-gray-900 dark:text-white">0 min</p>
                                <p id="perf-avg-total-trend" class="text-sm font-medium mt-2">-</p>
                            </div>
                        </div>

                        <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.1s;">
                            <div class="text-center">
                                <div class="relative inline-block mb-4">
                                    <div class="absolute -inset-1 bg-green-500 rounded-full pulse-ring opacity-30"></div>
                                    <div class="relative bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-full">
                                        <i class="fas fa-target text-white text-2xl"></i>
                                    </div>
                                </div>
                                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2">Taxa de Acerto</h4>
                                <p id="perf-hit-rate" class="text-3xl font-bold text-gray-900 dark:text-white">0%</p>
                                <p id="perf-hit-rate-trend" class="text-sm font-medium mt-2">-</p>
                            </div>
                        </div>

                        <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.2s;">
                            <div class="text-center">
                                <div class="relative inline-block mb-4">
                                    <div class="absolute -inset-1 bg-purple-500 rounded-full pulse-ring opacity-30"></div>
                                    <div class="relative bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-full">
                                        <i class="fas fa-truck text-white text-2xl"></i>
                                    </div>
                                </div>
                                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2">Produtividade</h4>
                                <p id="perf-productivity" class="text-3xl font-bold text-gray-900 dark:text-white">0 /dia</p>
                                <p id="perf-productivity-trend" class="text-sm font-medium mt-2">-</p>
                            </div>
                        </div>

                        <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.3s;">
                            <div class="text-center">
                                <div class="relative inline-block mb-4">
                                    <div class="absolute -inset-1 bg-orange-500 rounded-full pulse-ring opacity-30"></div>
                                    <div class="relative bg-gradient-to-r from-orange-500 to-orange-600 p-4 rounded-full">
                                        <i class="fas fa-exclamation-triangle text-white text-2xl"></i>
                                    </div>
                                </div>
                                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2">Outliers</h4>
                                <p id="perf-outliers" class="text-3xl font-bold text-gray-900 dark:text-white">0</p>
                                <p id="perf-outliers-trend" class="text-sm font-medium mt-2">-</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configurações Tab -->
        <div id="configuracoes-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Gerenciar Frentes -->
                <div class="chart-container shadow-2xl rounded-3xl p-8 card-hover">
                    <div class="flex items-center mb-8">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-gradient-to-r from-green-600 to-blue-600 rounded-full blur-sm opacity-75"></div>
                            <div class="relative bg-white dark:bg-gray-800 p-3 rounded-full">
                                <i class="fas fa-road text-2xl text-gradient"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <h2 class="text-2xl font-bold text-gradient">
                                Gerenciar Frentes
                            </h2>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Adicione, edite ou remova frentes de trabalho</p>
                        </div>
                    </div>

                    <!-- Formulário para nova frente -->
                    <div class="mb-6">
                        <div class="flex gap-4">
                            <input type="text" id="nova-frente" placeholder="Nome da nova frente (ex: 4011)" 
                                   class="flex-1 rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base px-4 py-3">
                            <button id="add-frente" 
                                    class="btn-primary text-white font-semibold py-3 px-6 rounded-2xl shadow-lg">
                                <i class="fas fa-plus mr-2"></i>Adicionar
                            </button>
                        </div>
                    </div>

                    <!-- Lista de frentes existentes -->
                    <div class="space-y-3">
                        <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Frentes Cadastradas:</h3>
                        <div id="frentes-list" class="space-y-2">
                            <!-- Lista será populada aqui -->
                        </div>
                    </div>
                </div>

                <!-- Backup & Restore -->
                <div class="chart-container shadow-2xl rounded-3xl p-8 card-hover">
                    <div class="flex items-center mb-8">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full blur-sm opacity-75"></div>
                            <div class="relative bg-white dark:bg-gray-800 p-3 rounded-full">
                                <i class="fas fa-database text-2xl text-gradient"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <h2 class="text-2xl font-bold text-gradient">
                                Backup & Restore
                            </h2>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Gerencie os dados do sistema</p>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- Backup Completo -->
                        <div class="bg-green-50 dark:bg-green-900/20 p-6 rounded-2xl border border-green-200 dark:border-green-800">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-download text-green-600 text-xl mr-3"></i>
                                <h3 class="font-semibold text-gray-900 dark:text-white">Exportar Backup Completo</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">
                                Baixe um arquivo contendo todos os dados e configurações do sistema
                            </p>
                            <button id="export-backup-complete" 
                                    class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-2xl shadow-lg transition-all duration-300 hover:transform hover:scale-105">
                                <i class="fas fa-file-archive mr-2"></i>Baixar Backup Completo
                            </button>
                        </div>

                        <!-- Restore -->
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-6 rounded-2xl border border-blue-200 dark:border-blue-800">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-upload text-blue-600 text-xl mr-3"></i>
                                <h3 class="font-semibold text-gray-900 dark:text-white">Importar Backup</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">
                                Restaure dados de um arquivo de backup (.json)
                            </p>
                            <button id="import-backup-complete" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-2xl shadow-lg transition-all duration-300 hover:transform hover:scale-105">
                                <i class="fas fa-folder-open mr-2"></i>Selecionar Arquivo
                            </button>
                        </div>

                        <!-- Limpar Dados -->
                        <div class="bg-red-50 dark:bg-red-900/20 p-6 rounded-2xl border border-red-200 dark:border-red-800">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-trash-alt text-red-600 text-xl mr-3"></i>
                                <h3 class="font-semibold text-gray-900 dark:text-white">Limpar Todos os Dados</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">
                                Remove permanentemente todos os registros do sistema. <strong>Esta ação não pode ser desfeita!</strong>
                            </p>
                            <button id="clear-all-data-config" 
                                    class="bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-2xl shadow-lg transition-all duration-300 hover:transform hover:scale-105">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Limpar Todos os Dados
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configurações Gerais -->
            <div class="mt-8 chart-container shadow-2xl rounded-3xl p-8 card-hover">
                <div class="flex items-center mb-8">
                    <div class="relative">
                        <div class="absolute -inset-1 bg-gradient-to-r from-orange-600 to-red-600 rounded-full blur-sm opacity-75"></div>
                        <div class="relative bg-white dark:bg-gray-800 p-3 rounded-full">
                            <i class="fas fa-cogs text-2xl text-gradient"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h2 class="text-2xl font-bold text-gradient">
                            Configurações do Sistema
                        </h2>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Ajuste as configurações gerais do sistema</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Configuração da Usina Padrão -->
                    <div class="space-y-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            <i class="fas fa-industry mr-2"></i>Usina Padrão
                        </label>
                        <input type="text" id="config-usina-padrao" value="4 CAMBUI" 
                               class="w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base px-4 py-3">
                    </div>

                    <!-- Limite de Tempo Palha -->
                    <div class="space-y-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            <i class="fas fa-clock mr-2"></i>Limite Tempo Palha (min)
                        </label>
                        <input type="number" id="config-limite-palha" value="40" min="1" max="120"
                               class="w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base px-4 py-3">
                    </div>

                    <!-- Limite de Tempo Pátio -->
                    <div class="space-y-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            <i class="fas fa-chart-line mr-2"></i>Limite Tempo Pátio (min)
                        </label>
                        <input type="number" id="config-limite-patio" value="40" min="1" max="120"
                               class="w-full rounded-2xl border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base px-4 py-3">
                    </div>
                </div>

                <!-- Botão Salvar Configurações -->
                <div class="mt-8 flex justify-end">
                    <button id="save-config" 
                            class="btn-primary text-white font-semibold py-4 px-8 rounded-2xl text-lg shadow-lg">
                        <i class="fas fa-save mr-3"></i>Salvar Configurações
                    </button>
                </div>

                <!-- Informações do Sistema -->
                <div class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-info-circle mr-2"></i>Informações do Sistema
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm">
                        <div class="stat-card p-4 rounded-2xl">
                            <div class="flex items-center">
                                <i class="fas fa-database text-blue-600 text-lg mr-3"></i>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400">Total de Registros</p>
                                    <p id="info-total-records" class="font-bold text-lg">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card p-4 rounded-2xl">
                            <div class="flex items-center">
                                <i class="fas fa-road text-green-600 text-lg mr-3"></i>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400">Frentes Cadastradas</p>
                                    <p id="info-total-frentes" class="font-bold text-lg">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card p-4 rounded-2xl">
                            <div class="flex items-center">
                                <i class="fas fa-calendar text-purple-600 text-lg mr-3"></i>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400">Último Backup</p>
                                    <p id="info-last-backup" class="font-bold text-lg">Nunca</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Custom Modal for Confirmations -->
    <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
            <div class="flex items-center mb-4">
                <i id="modal-icon" class="fas fa-question-circle text-2xl text-blue-500 mr-3"></i>
                <h3 id="modal-title" class="text-lg font-medium text-gray-900 dark:text-white"></h3>
            </div>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6"></p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition duration-150">
                    Cancelar
                </button>
                <button id="modal-confirm" class="px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded transition duration-150">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Global variables
        let data = JSON.parse(localStorage.getItem('patiopalha-data') || '[]');
        let editingIndex = -1;
        let charts = {};
        let currentMode = 'simples';
        let wizardStep = 1;
        let rapidEntries = [];
        let caminhaoHistory = JSON.parse(localStorage.getItem('patiopalha-caminhao-history') || '[]');
        let formProgress = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            setupEventListeners();
            updateDataTable();
            updateReports();
        });

        function updateCurrentDate() {
            const now = new Date();
            document.getElementById('current-date').textContent = 
                now.toLocaleDateString('pt-BR') + ' ' + now.toLocaleTimeString('pt-BR');
        }

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;
                    switchTab(targetTab);
                });
            });

            // Form submission
            document.getElementById('data-form').addEventListener('submit', handleFormSubmit);

            // Clear form
            document.getElementById('clear-form').addEventListener('click', clearForm);

            // Export CSV
            document.getElementById('export-csv').addEventListener('click', exportToCSV);

            // Advanced functionality event listeners
            setupAdvancedListeners();

            // Clear all data
            document.getElementById('clear-all-data').addEventListener('click', function() {
                showCustomModal(
                    'Confirmar Exclusão',
                    'Tem certeza que deseja excluir todos os dados? Esta ação não pode ser desfeita.',
                    'fas fa-exclamation-triangle text-red-500',
                    function() {
                        data = [];
                        saveData();
                        updateDataTable();
                        updateReports();
                        updateDashboard();
                        showToast('Todos os dados foram excluídos', 'success');
                    }
                );
            });

            // Modal events
            document.getElementById('modal-cancel').addEventListener('click', hideCustomModal);
            document.getElementById('custom-modal').addEventListener('click', function(e) {
                if (e.target === this) hideCustomModal();
            });

            // Update current time every minute
            setInterval(updateCurrentDate, 60000);
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-indigo-500', 'text-indigo-600', 'dark:text-indigo-400');
                btn.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            });

            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'border-indigo-500', 'text-indigo-600', 'dark:text-indigo-400');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            document.getElementById(`${tabName}-tab`).classList.remove('hidden');

            // Update reports if switching to reports tab
            if (tabName === 'relatorios') {
                updateReports();
            }
            
            // Update dashboard if switching to dashboard tab
            if (tabName === 'dashboard') {
                updateDashboard();
            }
        }

        function handleFormSubmit(e) {
            e.preventDefault();

            const formData = {
                usina: document.getElementById('usina').value,
                caminhao: document.getElementById('caminhao').value,
                frenteSaida: document.getElementById('frente-saida').value,
                saidaCentral: document.getElementById('saida-central').value,
                chegadaPalha: document.getElementById('chegada-palha').value,
                saidaPalha: document.getElementById('saida-palha').value,
                chegadaUsina: document.getElementById('chegada-usina').value,
                saidaPesagem: document.getElementById('saida-pesagem').value
            };

            // Calculate times
            const temposPalha = calculateTimeDifference(formData.chegadaPalha, formData.saidaPalha);
            const temposUsina = calculateTimeDifference(formData.chegadaUsina, formData.saidaPesagem);

            const entry = {
                ...formData,
                tempoPalha: temposPalha,
                tempoUsina: temposUsina,
                timestamp: new Date().toISOString()
            };

            if (editingIndex >= 0) {
                data[editingIndex] = entry;
                editingIndex = -1;
                showToast('Dados atualizados com sucesso!', 'success');
            } else {
                data.push(entry);
                showToast('Dados salvos com sucesso!', 'success');
            }

            saveData();
            clearForm();
            updateDataTable();
            updateReports();
            updateDashboard();
        }

        function calculateTimeDifference(start, end) {
            const startDate = new Date(start);
            const endDate = new Date(end);
            const diffMs = endDate - startDate;
            const diffMinutes = Math.round(diffMs / (1000 * 60));
            return diffMinutes;
        }

        function clearForm() {
            document.getElementById('data-form').reset();
            document.getElementById('usina').value = '4 CAMBUI';
            editingIndex = -1;
        }

        function saveData() {
            localStorage.setItem('patiopalha-data', JSON.stringify(data));
        }

        function updateDataTable() {
            const tableBody = document.getElementById('data-table');
            const noDataDiv = document.getElementById('no-data');

            if (data.length === 0) {
                tableBody.innerHTML = '';
                noDataDiv.classList.remove('hidden');
                return;
            }

            noDataDiv.classList.add('hidden');
            
            tableBody.innerHTML = data.map((entry, index) => `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${entry.usina}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${entry.caminhao}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.saidaCentral)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.chegadaPalha)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.saidaPalha)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold ${entry.tempoPalha > 40 ? 'text-red-600' : 'text-green-600'}">${entry.tempoPalha}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.chegadaUsina)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.saidaPesagem)}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold ${entry.tempoUsina > 40 ? 'text-red-600' : 'text-green-600'}">${entry.tempoUsina}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${entry.frenteSaida}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm font-medium no-print">
                        <button onclick="editEntry(${index})" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteEntry(${index})" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleString('pt-BR');
        }

        function editEntry(index) {
            const entry = data[index];
            editingIndex = index;

            // Fill form with entry data
            document.getElementById('usina').value = entry.usina;
            document.getElementById('caminhao').value = entry.caminhao;
            document.getElementById('frente-saida').value = entry.frenteSaida;
            document.getElementById('saida-central').value = entry.saidaCentral;
            document.getElementById('chegada-palha').value = entry.chegadaPalha;
            document.getElementById('saida-palha').value = entry.saidaPalha;
            document.getElementById('chegada-usina').value = entry.chegadaUsina;
            document.getElementById('saida-pesagem').value = entry.saidaPesagem;

            // Switch to entrada tab
            switchTab('entrada');
            showToast('Modo de edição ativado', 'info');
        }

        function deleteEntry(index) {
            showCustomModal(
                'Confirmar Exclusão',
                'Tem certeza que deseja excluir este registro?',
                'fas fa-exclamation-triangle text-red-500',
                function() {
                    data.splice(index, 1);
                    saveData();
                    updateDataTable();
                    updateReports();
                    updateDashboard();
                    showToast('Registro excluído com sucesso', 'success');
                }
            );
        }

        function updateReports() {
            updateAdvancedReports();
            
            // Manter compatibilidade com relatórios simples existentes
            frentes.forEach(frente => {
                generateReport(frente);
            });

            generateSummaryReport();
        }

        function generateReport(frente) {
            const frenteData = data.filter(entry => entry.frenteSaida === frente);
            const reportDiv = document.getElementById(`report-${frente}`);

            if (frenteData.length === 0) {
                reportDiv.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">Nenhum dado para esta frente</p>';
                return;
            }

            // Group by shift
            const shifts = {
                'A': frenteData.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 6 && hour < 14;
                }),
                'B': frenteData.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 14 && hour < 22;
                }),
                'C': frenteData.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 22 || hour < 6;
                })
            };

            let reportHTML = '<div class="space-y-3">';
            
            Object.keys(shifts).forEach(shift => {
                const shiftData = shifts[shift];
                if (shiftData.length === 0) return;

                // Filter valid data (tempo <= 40 min)
                const validPalhaData = shiftData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 40);
                const validUsinaData = shiftData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 40);

                const avgPalha = validPalhaData.length > 0 ? 
                    (validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length).toFixed(1) : 0;
                
                const avgUsina = validUsinaData.length > 0 ? 
                    (validUsinaData.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsinaData.length).toFixed(1) : 0;

                reportHTML += `
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-medium text-gray-900 dark:text-white">Turno ${shift}</span>
                            <span class="text-sm text-gray-500 dark:text-gray-400">${shiftData.length} viagens</span>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Tempo Palha:</span>
                                <span class="font-semibold text-blue-600 dark:text-blue-400">${avgPalha} min</span>
                            </div>
                            <div>
                                <span class="text-gray-600 dark:text-gray-400">Tempo Pátio:</span>
                                <span class="font-semibold text-green-600 dark:text-green-400">${avgUsina} min</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Add statistics
            const validPalhaTotal = frenteData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 40);
            const validUsinaTotal = frenteData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 40);
            const desconsideradosPalha = frenteData.filter(entry => entry.tempoPalha <= 0 || entry.tempoPalha > 40).length;
            const desconsideradosUsina = frenteData.filter(entry => entry.tempoUsina <= 0 || entry.tempoUsina > 40).length;

            reportHTML += `
                <div class="border-t border-gray-200 dark:border-gray-600 pt-3">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">Observações</h4>
                    <div class="text-sm space-y-1">
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Valores desconsiderados (Palha):</span>
                            <span class="text-red-600 dark:text-red-400">${desconsideradosPalha}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Valores desconsiderados (Pátio):</span>
                            <span class="text-red-600 dark:text-red-400">${desconsideradosUsina}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Viagens consideradas (Palha):</span>
                            <span class="text-green-600 dark:text-green-400">${validPalhaTotal.length}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Viagens consideradas (Pátio):</span>
                            <span class="text-green-600 dark:text-green-400">${validUsinaTotal.length}</span>
                        </div>
                    </div>
                </div>
            `;

            reportHTML += '</div>';
            reportDiv.innerHTML = reportHTML;
        }

        function generateSummaryReport() {
            const summaryDiv = document.getElementById('summary-report');
            
            const totalEntries = data.length;
            const today = new Date().toDateString();
            const todayEntries = data.filter(entry => new Date(entry.timestamp).toDateString() === today);

            // Calculate overall averages
            const validPalhaData = data.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 40);
            const validUsinaData = data.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 40);

            const avgPalha = validPalhaData.length > 0 ? 
                (validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length).toFixed(1) : 0;
            
            const avgUsina = validUsinaData.length > 0 ? 
                (validUsinaData.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsinaData.length).toFixed(1) : 0;

            // Calculate median
            const sortedPalha = validPalhaData.map(entry => entry.tempoPalha).sort((a, b) => a - b);
            const medianPalha = sortedPalha.length > 0 ? 
                (sortedPalha.length % 2 === 0 ? 
                    (sortedPalha[sortedPalha.length/2-1] + sortedPalha[sortedPalha.length/2]) / 2 : 
                    sortedPalha[Math.floor(sortedPalha.length/2)]).toFixed(1) : 0;

            summaryDiv.innerHTML = `
                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-day text-blue-600 text-xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Registros Hoje</p>
                            <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">${todayEntries.length}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-database text-green-600 text-xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Total de Registros</p>
                            <p class="text-2xl font-bold text-green-600 dark:text-green-400">${totalEntries}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-purple-600 text-xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Média Tempo Palha</p>
                            <p class="text-2xl font-bold text-purple-600 dark:text-purple-400">${avgPalha} min</p>
                        </div>
                    </div>
                </div>

                <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-chart-line text-yellow-600 text-xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Mediana Tempo Palha</p>
                            <p class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">${medianPalha} min</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function exportToCSV() {
            if (data.length === 0) {
                showToast('Nenhum dado para exportar', 'warning');
                return;
            }

            const headers = [
                'Usina', 'Caminhão', 'Dt./Hr. Saida Central Trafego', 'Dt./Hr. Chegada Palha',
                'Dt hr saida palha', 'tempo de palha ,minutos', 'Dt./Hr. Chegada Usina',
                'Dt./Hr. Saída Pesagem', 'tempo de usina ,minutos', 'Frente saida'
            ];

            const csvContent = [
                headers.join(','),
                ...data.map(entry => [
                    entry.usina,
                    entry.caminhao,
                    entry.saidaCentral,
                    entry.chegadaPalha,
                    entry.saidaPalha,
                    entry.tempoPalha,
                    entry.chegadaUsina,
                    entry.saidaPesagem,
                    entry.tempoUsina,
                    entry.frenteSaida
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `tempo_patio_palha_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            showToast('Arquivo CSV exportado com sucesso!', 'success');
        }

        function showCustomModal(title, message, iconClass, onConfirm) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('modal-icon').className = iconClass;
            
            const confirmBtn = document.getElementById('modal-confirm');
            confirmBtn.onclick = function() {
                hideCustomModal();
                if (onConfirm) onConfirm();
            };

            document.getElementById('custom-modal').classList.remove('hidden');
        }

        function hideCustomModal() {
            document.getElementById('custom-modal').classList.add('hidden');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            }[type] || 'bg-blue-500';

            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
            toast.textContent = message;

            document.body.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);

            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Dashboard Functions
        function updateDashboard() {
            updateAdvancedKPIs();
            createCharts();
            generatePerformanceAlerts();
            setupDashboardListeners();
        }

        function setupDashboardListeners() {
            // Dashboard period filter
            document.getElementById('dashboard-period').addEventListener('change', updateDashboard);
            
            // Refresh button
            document.getElementById('refresh-dashboard').addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Atualizando...';
                setTimeout(() => {
                    updateDashboard();
                    this.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>Atualizar';
                    showToast('Dashboard atualizado!', 'success');
                }, 1000);
            });
        }

        function updateAdvancedKPIs() {
            const period = document.getElementById('dashboard-period')?.value || '7';
            const filteredData = getFilteredDataByPeriod(period);
            
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toDateString();
            
            const todayEntries = filteredData.filter(entry => new Date(entry.timestamp).toDateString() === today);
            const yesterdayEntries = filteredData.filter(entry => new Date(entry.timestamp).toDateString() === yesterday);
            
            // Calculate averages
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= configurations.limitePalha);
            const validUsinaData = filteredData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= configurations.limitePatio);
            const allPalhaData = filteredData.filter(entry => entry.tempoPalha > 0);
            const allUsinaData = filteredData.filter(entry => entry.tempoUsina > 0);

            const avgPalha = validPalhaData.length > 0 ? 
                (validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length) : 0;
            
            const avgUsina = validUsinaData.length > 0 ? 
                (validUsinaData.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsinaData.length) : 0;

            // Calculate efficiency (% of records within limits)
            const efficiencyPalha = allPalhaData.length > 0 ? (validPalhaData.length / allPalhaData.length) * 100 : 0;
            const efficiencyUsina = allUsinaData.length > 0 ? (validUsinaData.length / allUsinaData.length) * 100 : 0;
            const overallEfficiency = ((efficiencyPalha + efficiencyUsina) / 2);

            // Active fronts calculation
            const activeFronts = [...new Set(filteredData.map(entry => entry.frenteSaida))].length;

            // Update KPI displays with animations
            animateNumber('kpi-today', todayEntries.length);
            animateNumber('kpi-total', filteredData.length);
            animateNumberFloat('kpi-avg-palha', avgPalha, 'min');
            animateNumberFloat('kpi-avg-patio', avgUsina, 'min');
            animateNumberFloat('kpi-efficiency', overallEfficiency, '%');
            animateNumber('kpi-frentes-ativas', activeFronts);

            // Update status indicators
            updateKPIStatus('kpi-today-change', todayEntries.length, yesterdayEntries.length, 'registros');
            updateKPIStatus('kpi-palha-status', avgPalha, configurations.limitePalha, 'target', true);
            updateKPIStatus('kpi-patio-status', avgUsina, configurations.limitePatio, 'target', true);
            updateKPIStatus('kpi-efficiency-status', overallEfficiency, 85, 'target');

            // Update progress bars
            updateProgressBar('kpi-today-progress', Math.min((todayEntries.length / 50) * 100, 100)); // Max 50 per day
            updateProgressBar('kpi-palha-progress', Math.max(0, 100 - (avgPalha / configurations.limitePalha) * 100));
            updateProgressBar('kpi-patio-progress', Math.max(0, 100 - (avgUsina / configurations.limitePatio) * 100));
            updateProgressBar('kpi-efficiency-progress', overallEfficiency);
            updateProgressBar('kpi-frentes-progress', (activeFronts / frentes.length) * 100);
        }

        function getFilteredDataByPeriod(period) {
            if (period === 'all') return data;
            
            const days = parseInt(period);
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - days);
            
            return data.filter(entry => new Date(entry.timestamp) >= cutoffDate);
        }

        function animateNumber(elementId, targetValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = parseInt(element.textContent) || 0;
            const duration = 1000;
            const startTime = performance.now();

            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentValue = Math.round(startValue + (targetValue - startValue) * easeOutCubic(progress));
                element.textContent = currentValue;

                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }

            requestAnimationFrame(updateNumber);
        }

        function animateNumberFloat(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = parseFloat(element.textContent) || 0;
            const duration = 1000;
            const startTime = performance.now();

            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentValue = startValue + (targetValue - startValue) * easeOutCubic(progress);
                element.textContent = currentValue.toFixed(1) + suffix;

                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }

            requestAnimationFrame(updateNumber);
        }

        function updateKPIStatus(elementId, currentValue, compareValue, type = 'change', invert = false) {
            const element = document.getElementById(elementId);
            if (!element) return;

            let statusText = '';
            let statusClass = '';

            if (type === 'change') {
                const diff = currentValue - compareValue;
                if (diff > 0) {
                    statusText = `+${diff} vs ontem`;
                    statusClass = 'text-green-600 dark:text-green-400';
                } else if (diff < 0) {
                    statusText = `${diff} vs ontem`;
                    statusClass = 'text-red-600 dark:text-red-400';
                } else {
                    statusText = 'Sem mudança';
                    statusClass = 'text-gray-600 dark:text-gray-400';
                }
            } else if (type === 'target') {
                const isGood = invert ? currentValue <= compareValue : currentValue >= compareValue;
                if (isGood) {
                    statusText = 'Dentro da meta';
                    statusClass = 'text-green-600 dark:text-green-400';
                } else {
                    statusText = 'Fora da meta';
                    statusClass = 'text-red-600 dark:text-red-400';
                }
            }

            element.textContent = statusText;
            element.className = `text-xs font-medium ${statusClass}`;
        }

        function updateProgressBar(elementId, percentage) {
            const element = document.getElementById(elementId);
            if (!element) return;

            element.style.width = Math.min(Math.max(percentage, 0), 100) + '%';
        }

        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        function generatePerformanceAlerts() {
            const alertsContainer = document.getElementById('performance-alerts');
            if (!alertsContainer) return;

            const period = document.getElementById('dashboard-period')?.value || '7';
            const filteredData = getFilteredDataByPeriod(period);
            
            const alerts = [];

            // Check for high time averages
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const validUsinaData = filteredData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 60);

            if (validPalhaData.length > 0) {
                const avgPalha = validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length;
                if (avgPalha > configurations.limitePalha) {
                    alerts.push({
                        type: 'warning',
                        icon: 'fas fa-clock',
                        title: 'Tempo de Palha Alto',
                        message: `Média de ${avgPalha.toFixed(1)} min excede o limite de ${configurations.limitePalha} min`,
                        action: 'Revisar processos de carga'
                    });
                }
            }

            if (validUsinaData.length > 0) {
                const avgUsina = validUsinaData.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsinaData.length;
                if (avgUsina > configurations.limitePatio) {
                    alerts.push({
                        type: 'warning',
                        icon: 'fas fa-chart-line',
                        title: 'Tempo de Pátio Alto',
                        message: `Média de ${avgUsina.toFixed(1)} min excede o limite de ${configurations.limitePatio} min`,
                        action: 'Otimizar fluxo no pátio'
                    });
                }
            }

            // Check for front performance issues
            frentes.forEach(frente => {
                const frenteData = filteredData.filter(entry => entry.frenteSaida === frente);
                if (frenteData.length > 5) { // Only check fronts with sufficient data
                    const frenteAvgPalha = frenteData.reduce((sum, entry) => sum + (entry.tempoPalha || 0), 0) / frenteData.length;
                    if (frenteAvgPalha > configurations.limitePalha * 1.2) {
                        alerts.push({
                            type: 'error',
                            icon: 'fas fa-road',
                            title: `Frente ${frente} - Performance Baixa`,
                            message: `Tempo médio de ${frenteAvgPalha.toFixed(1)} min muito alto`,
                            action: 'Investigar problemas específicos'
                        });
                    }
                }
            });

            // Check for efficiency drop
            const efficiency = calculateOverallEfficiency(filteredData);
            if (efficiency < 70 && filteredData.length > 10) {
                alerts.push({
                    type: 'error',
                    icon: 'fas fa-exclamation-triangle',
                    title: 'Eficiência Baixa',
                    message: `Apenas ${efficiency.toFixed(1)}% dos registros dentro dos limites`,
                    action: 'Revisão geral necessária'
                });
            }

            // Check for data quality issues
            const invalidData = filteredData.filter(entry => entry.tempoPalha <= 0 || entry.tempoUsina <= 0);
            if (invalidData.length > filteredData.length * 0.1) {
                alerts.push({
                    type: 'info',
                    icon: 'fas fa-database',
                    title: 'Dados Inconsistentes',
                    message: `${invalidData.length} registros com tempos inválidos`,
                    action: 'Verificar qualidade dos dados'
                });
            }

            // Success message if no alerts
            if (alerts.length === 0) {
                alerts.push({
                    type: 'success',
                    icon: 'fas fa-check-circle',
                    title: 'Performance Excelente',
                    message: 'Todos os indicadores estão dentro dos parâmetros normais',
                    action: 'Continue o bom trabalho!'
                });
            }

            // Render alerts
            alertsContainer.innerHTML = alerts.map(alert => `
                <div class="alert-card bg-${getAlertColor(alert.type)}-50 dark:bg-${getAlertColor(alert.type)}-900/20 border border-${getAlertColor(alert.type)}-200 dark:border-${getAlertColor(alert.type)}-800 rounded-2xl p-6 card-hover">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <div class="relative">
                                <div class="absolute -inset-1 bg-${getAlertColor(alert.type)}-500 rounded-full pulse-ring opacity-30"></div>
                                <div class="relative bg-gradient-to-r from-${getAlertColor(alert.type)}-500 to-${getAlertColor(alert.type)}-600 p-3 rounded-full">
                                    <i class="${alert.icon} text-white text-lg"></i>
                                </div>
                            </div>
                        </div>
                        <div class="ml-4 flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">${alert.title}</h3>
                            <p class="text-gray-600 dark:text-gray-300 mb-3">${alert.message}</p>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-lightbulb text-${getAlertColor(alert.type)}-600 mr-2"></i>
                                <span class="text-${getAlertColor(alert.type)}-700 dark:text-${getAlertColor(alert.type)}-300 font-medium">${alert.action}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getAlertColor(type) {
            const colors = {
                'success': 'green',
                'warning': 'yellow',
                'error': 'red',
                'info': 'blue'
            };
            return colors[type] || 'gray';
        }

        function calculateOverallEfficiency(dataSet) {
            if (dataSet.length === 0) return 0;
            
            const validData = dataSet.filter(entry => 
                entry.tempoPalha > 0 && entry.tempoPalha <= configurations.limitePalha &&
                entry.tempoUsina > 0 && entry.tempoUsina <= configurations.limitePatio
            );
            
            return (validData.length / dataSet.length) * 100;
        }

        function updateKPIs() {
            // Keep for backward compatibility
            updateAdvancedKPIs();
        }

        function createCharts() {
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};

            if (data.length === 0) return;

            createFrenteChart();
            createTurnoChart();
            createEvolutionChart();
            createComparisonChart();
            createHistogramChart();
            createTrucksChart();
            createProductivityChart();
            createEfficiencyHeatmap();
        }

        function createFrenteChart() {
            const ctx = document.getElementById('chart-frente').getContext('2d');
            
            const frenteData = frentes.map(frente => {
                const frenteEntries = data.filter(entry => entry.frenteSaida === frente);
                const validPalha = frenteEntries.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 40);
                const validUsina = frenteEntries.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 40);
                
                return {
                    frente,
                    avgPalha: validPalha.length > 0 ? validPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalha.length : 0,
                    avgUsina: validUsina.length > 0 ? validUsina.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsina.length : 0,
                    count: frenteEntries.length
                };
            });

            charts.frente = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: frentes,
                    datasets: [
                        {
                            label: 'Tempo Palha (min)',
                            data: frenteData.map(f => f.avgPalha.toFixed(1)),
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: '#1D4ED8',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false,
                        },
                        {
                            label: 'Tempo Pátio (min)',
                            data: frenteData.map(f => f.avgUsina.toFixed(1)),
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: '#047857',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#6366F1',
                            borderWidth: 1,
                            callbacks: {
                                afterBody: function(context) {
                                    const index = context[0].dataIndex;
                                    const frente = frenteData[index];
                                    return [`Total de viagens: ${frente.count}`];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tempo (minutos)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutCubic'
                    }
                }
            });
        }

        function createTurnoChart() {
            const ctx = document.getElementById('chart-turno').getContext('2d');
            
            const shifts = {
                'A': data.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 6 && hour < 14;
                }),
                'B': data.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 14 && hour < 22;
                }),
                'C': data.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 22 || hour < 6;
                })
            };

            const shiftCounts = Object.keys(shifts).map(shift => shifts[shift].length);

            charts.turno = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Turno A (6h-14h)', 'Turno B (14h-22h)', 'Turno C (22h-6h)'],
                    datasets: [{
                        data: shiftCounts,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ],
                        borderColor: ['#1D4ED8', '#047857', '#6D28D9'],
                        borderWidth: 3,
                        hoverBackgroundColor: [
                            'rgba(59, 130, 246, 0.9)',
                            'rgba(16, 185, 129, 0.9)',
                            'rgba(139, 92, 246, 0.9)'
                        ],
                        hoverBorderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    if (data.labels.length && data.datasets.length) {
                                        return data.labels.map((label, i) => {
                                            const dataset = data.datasets[0];
                                            const value = dataset.data[i];
                                            const total = dataset.data.reduce((sum, val) => sum + val, 0);
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            return {
                                                text: `${label}: ${value} (${percentage}%)`,
                                                fillStyle: dataset.backgroundColor[i],
                                                strokeStyle: dataset.borderColor[i],
                                                pointStyle: 'circle'
                                            };
                                        });
                                    }
                                    return [];
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#6366F1',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                    const percentage = ((context.raw / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.raw} viagens (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutCubic',
                        animateRotate: true,
                        animateScale: true
                    },
                    cutout: '60%'
                }
            });
        }

        function createEvolutionChart() {
            const ctx = document.getElementById('chart-evolution').getContext('2d');
            
            // Get last 7 days
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date.toDateString());
            }

            const evolutionData = last7Days.map(dateStr => {
                const dayData = data.filter(entry => new Date(entry.timestamp).toDateString() === dateStr);
                const validPalha = dayData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 40);
                const validUsina = dayData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 40);
                
                return {
                    date: new Date(dateStr).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' }),
                    avgPalha: validPalha.length > 0 ? validPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalha.length : 0,
                    avgUsina: validUsina.length > 0 ? validUsina.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsina.length : 0,
                    count: dayData.length
                };
            });

            charts.evolution = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: evolutionData.map(d => d.date),
                    datasets: [
                        {
                            label: 'Tempo Palha (min)',
                            data: evolutionData.map(d => d.avgPalha.toFixed(1)),
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#3B82F6',
                            pointBorderColor: '#FFFFFF',
                            pointBorderWidth: 2,
                            borderWidth: 3
                        },
                        {
                            label: 'Tempo Pátio (min)',
                            data: evolutionData.map(d => d.avgUsina.toFixed(1)),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#10B981',
                            pointBorderColor: '#FFFFFF',
                            pointBorderWidth: 2,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#6366F1',
                            borderWidth: 1,
                            callbacks: {
                                afterBody: function(context) {
                                    const index = context[0].dataIndex;
                                    const day = evolutionData[index];
                                    return [`Total de registros: ${day.count}`];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tempo (minutos)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutCubic'
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function createComparisonChart() {
            const ctx = document.getElementById('chart-comparison').getContext('2d');
            
            const comparisonData = frentes.map(frente => {
                const frenteEntries = data.filter(entry => entry.frenteSaida === frente);
                const validPalha = frenteEntries.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 40);
                const validUsina = frenteEntries.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 40);
                
                const avgPalha = validPalha.length > 0 ? validPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalha.length : 0;
                const avgUsina = validUsina.length > 0 ? validUsina.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsina.length : 0;
                
                return avgPalha - avgUsina; // Diferença entre palha e pátio
            });

            charts.comparison = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: frentes,
                    datasets: [{
                        label: 'Diferença (Palha - Pátio)',
                        data: comparisonData.map(d => d.toFixed(1)),
                        backgroundColor: comparisonData.map(d => d >= 0 ? '#10B981' : '#EF4444'),
                        borderColor: comparisonData.map(d => d >= 0 ? '#047857' : '#DC2626'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Diferença (minutos)'
                            }
                        }
                    }
                }
            });
        }

        function createHistogramChart() {
            const ctx = document.getElementById('chart-histogram').getContext('2d');
            
            const validPalhaData = data.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const tempos = validPalhaData.map(entry => entry.tempoPalha);
            
            // Create bins for histogram
            const bins = [
                { label: '0-5', min: 0, max: 5 },
                { label: '5-10', min: 5, max: 10 },
                { label: '10-15', min: 10, max: 15 },
                { label: '15-20', min: 15, max: 20 },
                { label: '20-25', min: 20, max: 25 },
                { label: '25-30', min: 25, max: 30 },
                { label: '30-35', min: 30, max: 35 },
                { label: '35-40', min: 35, max: 40 },
                { label: '40+', min: 40, max: 999 }
            ];

            const histogramData = bins.map(bin => 
                tempos.filter(tempo => tempo > bin.min && tempo <= bin.max).length
            );

            charts.histogram = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: bins.map(bin => bin.label + ' min'),
                    datasets: [{
                        label: 'Frequência',
                        data: histogramData,
                        backgroundColor: '#8B5CF6',
                        borderColor: '#6D28D9',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Número de Registros'
                            }
                        }
                    }
                }
            });
        }

        function createTrucksChart() {
            const ctx = document.getElementById('chart-trucks');
            if (!ctx) return;

            const period = document.getElementById('dashboard-period')?.value || '7';
            const filteredData = getFilteredDataByPeriod(period);
            
            // Group by truck and calculate averages
            const truckData = {};
            filteredData.forEach(entry => {
                if (!entry.caminhao || entry.caminhao.trim() === '') return; // Skip empty truck names
                
                const truckName = entry.caminhao.trim();
                if (!truckData[truckName]) {
                    truckData[truckName] = { palha: [], usina: [], total: 0 };
                }
                
                truckData[truckName].total++;
                
                if (entry.tempoPalha > 0) {
                    truckData[truckName].palha.push(entry.tempoPalha);
                }
                if (entry.tempoUsina > 0) {
                    truckData[truckName].usina.push(entry.tempoUsina);
                }
            });

            // Calculate averages and sort
            const truckAverages = Object.keys(truckData)
                .map(caminhao => {
                    const palhaData = truckData[caminhao].palha;
                    const usinaData = truckData[caminhao].usina;
                    const totalViagens = truckData[caminhao].total;
                    
                    const avgPalha = palhaData.length > 0 ? 
                        palhaData.reduce((sum, val) => sum + val, 0) / palhaData.length : 0;
                    const avgUsina = usinaData.length > 0 ? 
                        usinaData.reduce((sum, val) => sum + val, 0) / usinaData.length : 0;
                    
                    return { 
                        caminhao, 
                        avgPalha: Number(avgPalha.toFixed(1)), 
                        avgUsina: Number(avgUsina.toFixed(1)),
                        count: palhaData.length,
                        totalViagens
                    };
                })
                .filter(truck => truck.count >= 1) // At least 1 valid record
                .sort((a, b) => a.avgPalha - b.avgPalha) // Sort by average time (lower is better)
                .slice(0, 10); // Top 10

            // Clear previous chart
            const chartContainer = ctx.closest('.bg-white');
            
            if (truckAverages.length === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                chartContainer.innerHTML = `
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-truck mr-2 text-indigo-600"></i>Top 10 Caminhões (Tempo Médio)
                    </h3>
                    <div class="flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-truck text-4xl mb-4 opacity-50"></i>
                        <p class="text-center">Dados insuficientes para gerar o ranking</p>
                        <p class="text-sm text-center mt-2">É necessário pelo menos 1 registro por caminhão</p>
                    </div>
                `;
                return;
            }

            // Ensure the canvas exists in the container
            if (!chartContainer.querySelector('#chart-trucks')) {
                chartContainer.innerHTML = `
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-truck mr-2 text-indigo-600"></i>Top 10 Caminhões (Tempo Médio)
                    </h3>
                    <div class="h-80 overflow-y-auto">
                        <canvas id="chart-trucks"></canvas>
                    </div>
                `;
            }

            const newCtx = document.getElementById('chart-trucks');
            if (!newCtx) return;

            charts.trucks = new Chart(newCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: truckAverages.map(truck => truck.caminhao),
                    datasets: [
                        {
                            label: 'Tempo Médio Palha (min)',
                            data: truckAverages.map(truck => truck.avgPalha),
                            backgroundColor: '#6366F1',
                            borderColor: '#4F46E5',
                            borderWidth: 1,
                            borderRadius: 4
                        },
                        {
                            label: 'Tempo Médio Pátio (min)',
                            data: truckAverages.map(truck => truck.avgUsina),
                            backgroundColor: '#10B981',
                            borderColor: '#047857',
                            borderWidth: 1,
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // Horizontal bars
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const truck = truckAverages[context.dataIndex];
                                    return `Total de viagens: ${truck.totalViagens}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tempo (minutos)'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    elements: {
                        bar: {
                            borderWidth: 1,
                        }
                    }
                }
            });
        }

        // Advanced functionality functions
        function setupAdvancedListeners() {
            // Filter functionality
            document.getElementById('search-input').addEventListener('input', applyFilters);
            document.getElementById('date-from').addEventListener('change', applyFilters);
            document.getElementById('date-to').addEventListener('change', applyFilters);
            document.getElementById('frente-filter').addEventListener('change', applyFilters);
            document.getElementById('clear-filters').addEventListener('click', clearFilters);

            // Export dropdown
            document.getElementById('export-dropdown-btn').addEventListener('click', toggleExportDropdown);
            document.getElementById('export-csv-btn').addEventListener('click', () => { exportData('csv'); hideExportDropdown(); });
            document.getElementById('export-excel-btn').addEventListener('click', () => { exportData('excel'); hideExportDropdown(); });
            document.getElementById('export-pdf-btn').addEventListener('click', () => { exportData('pdf'); hideExportDropdown(); });

            // Import/Backup/Restore
            document.getElementById('import-data').addEventListener('click', importData);
            document.getElementById('backup-data').addEventListener('click', backupData);
            document.getElementById('restore-data').addEventListener('click', restoreData);

            // Advanced form functionality
            setupAdvancedFormListeners();

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('export-dropdown');
                const button = document.getElementById('export-dropdown-btn');
                if (!dropdown.contains(e.target) && !button.contains(e.target)) {
                    hideExportDropdown();
                }
            });
        }

        function setupAdvancedFormListeners() {
            // Mode switching
            document.getElementById('modo-simples').addEventListener('click', () => switchEntryMode('simples'));
            document.getElementById('modo-wizard').addEventListener('click', () => switchEntryMode('wizard'));
            document.getElementById('modo-rapido').addEventListener('click', () => switchEntryMode('rapido'));

            // Smart form functionality
            setupSmartFormFeatures();
            
            // Quick stats update
            updateQuickStats();
            
            // Real-time validation
            setupRealTimeValidation();
            
            // Auto-calculation
            setupAutoCalculation();
            
            // Import functionality
            document.getElementById('import-quick').addEventListener('click', importQuickData);
            
            // Duplicate last entry
            document.getElementById('duplicate-last').addEventListener('click', duplicateLastEntry);
            
            // Recent entries refresh
            document.getElementById('refresh-recent').addEventListener('click', updateRecentEntries);
            
            // Update recent entries on load
            updateRecentEntries();
        }

        function switchEntryMode(mode) {
            currentMode = mode;
            
            // Update mode buttons
            document.querySelectorAll('#entrada-tab .flex .bg-gray-100 button').forEach(btn => {
                btn.classList.remove('bg-white', 'dark:bg-gray-600', 'text-gray-900', 'dark:text-white', 'shadow-sm');
                btn.classList.add('text-gray-600', 'dark:text-gray-400');
            });
            
            document.getElementById(`modo-${mode}`).classList.remove('text-gray-600', 'dark:text-gray-400');
            document.getElementById(`modo-${mode}`).classList.add('bg-white', 'dark:bg-gray-600', 'text-gray-900', 'dark:text-white', 'shadow-sm');
            
            // Show/hide entry modes
            document.querySelectorAll('.entrada-mode').forEach(modeDiv => {
                modeDiv.classList.add('hidden');
            });
            
            document.getElementById(`entrada-${mode}`).classList.remove('hidden');
            
            // Initialize mode-specific features
            if (mode === 'wizard') {
                initializeWizard();
            } else if (mode === 'rapido') {
                initializeRapidEntry();
            }
            
            showToast(`Modo ${mode} ativado`, 'info');
        }

        function setupSmartFormFeatures() {
            // Auto-complete for caminhão
            const caminhaoInput = document.getElementById('caminhao');
            const suggestionsDiv = document.getElementById('caminhao-suggestions');
            
            caminhaoInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                
                if (value.length < 1) {
                    suggestionsDiv.classList.add('hidden');
                    return;
                }
                
                // Filter suggestions from history
                const suggestions = [...new Set(caminhaoHistory)]
                    .filter(truck => truck.toLowerCase().includes(value))
                    .slice(0, 5);
                
                if (suggestions.length > 0) {
                    suggestionsDiv.innerHTML = suggestions.map(truck => `
                        <div class="px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-900 dark:text-white" onclick="selectCaminhao('${truck}')">
                            <i class="fas fa-truck mr-2 text-gray-400"></i>${truck}
                        </div>
                    `).join('');
                    suggestionsDiv.classList.remove('hidden');
                } else {
                    suggestionsDiv.classList.add('hidden');
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!caminhaoInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.classList.add('hidden');
                }
            });
            
            // "Agora" buttons for datetime inputs
            setupAgoraButtons();
            
            // Load frentes into selects
            updateFrenteSelects();
        }

        function selectCaminhao(truck) {
            document.getElementById('caminhao').value = truck;
            document.getElementById('caminhao-suggestions').classList.add('hidden');
            validateField('caminhao');
            updateFormProgress();
        }

        function setupAgoraButtons() {
            const agoraButtons = [
                'btn-agora-saida',
                'btn-agora-chegada-palha',
                'btn-agora-saida-palha',
                'btn-agora-chegada-usina',
                'btn-agora-saida-pesagem'
            ];
            
            agoraButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', function() {
                        const inputId = btnId.replace('btn-agora-', '').replace(/-/g, '-');
                        const input = document.getElementById(inputId);
                        
                        if (input) {
                            const now = new Date();
                            const formattedDate = now.toISOString().slice(0, 16);
                            input.value = formattedDate;
                            validateField(inputId);
                            updateFormProgress();
                            calculatePreviewTimes();
                        }
                    });
                }
            });
        }

        function setupRealTimeValidation() {
            const requiredFields = ['caminhao', 'frente-saida', 'saida-central', 'chegada-palha', 'saida-palha', 'chegada-usina', 'saida-pesagem'];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', () => {
                        validateField(fieldId);
                        updateFormProgress();
                        calculatePreviewTimes();
                    });
                    field.addEventListener('change', () => {
                        validateField(fieldId);
                        updateFormProgress();
                        calculatePreviewTimes();
                    });
                }
            });
        }

        function validateField(fieldId) {
            const field = document.getElementById(fieldId);
            const statusIcon = document.getElementById(`${fieldId}-status`);
            const feedback = document.getElementById(`${fieldId}-feedback`);
            
            if (!field || !statusIcon || !feedback) return;
            
            let isValid = false;
            let message = '';
            
            switch (fieldId) {
                case 'caminhao':
                    isValid = field.value.trim().length > 0;
                    message = isValid ? 'Caminhão válido' : 'Digite o código do caminhão';
                    break;
                    
                case 'frente-saida':
                    isValid = field.value !== '';
                    message = isValid ? 'Frente selecionada' : 'Selecione uma frente';
                    break;
                    
                default:
                    if (fieldId.includes('saida-') || fieldId.includes('chegada-')) {
                        isValid = field.value !== '';
                        message = isValid ? 'Data/hora válida' : 'Informe data e hora';
                    }
                    break;
            }
            
            // Update status icon and message
            statusIcon.className = `fas fa-circle text-xs mr-2 ${isValid ? 'text-green-500' : 'text-red-500'}`;
            feedback.textContent = message;
            feedback.className = `text-xs ${isValid ? 'text-green-600' : 'text-red-600'}`;
            
            return isValid;
        }

        function updateFormProgress() {
            const requiredFields = ['caminhao', 'frente-saida', 'saida-central', 'chegada-palha', 'saida-palha', 'chegada-usina', 'saida-pesagem'];
            let validFields = 0;
            
            requiredFields.forEach(fieldId => {
                if (validateField(fieldId)) {
                    validFields++;
                }
            });
            
            formProgress = (validFields / requiredFields.length) * 100;
            
            // Update progress bar
            document.getElementById('form-progress-bar').style.width = `${formProgress}%`;
            document.getElementById('form-progress-text').textContent = `${Math.round(formProgress)}%`;
            
            // Enable/disable save button
            const saveBtn = document.getElementById('btn-salvar');
            if (saveBtn) {
                saveBtn.disabled = formProgress < 100;
                if (formProgress === 100) {
                    saveBtn.classList.remove('disabled:opacity-50', 'disabled:cursor-not-allowed');
                } else {
                    saveBtn.classList.add('disabled:opacity-50', 'disabled:cursor-not-allowed');
                }
            }
        }

        function setupAutoCalculation() {
            // Set up listeners for time calculation
            const timeFields = ['chegada-palha', 'saida-palha', 'chegada-usina', 'saida-pesagem'];
            
            timeFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', calculatePreviewTimes);
                }
            });
        }

        function calculatePreviewTimes() {
            const chegadaPalha = document.getElementById('chegada-palha').value;
            const saidaPalha = document.getElementById('saida-palha').value;
            const chegadaUsina = document.getElementById('chegada-usina').value;
            const saidaPesagem = document.getElementById('saida-pesagem').value;
            
            // Calculate tempo de palha
            if (chegadaPalha && saidaPalha) {
                const tempoPalha = calculateTimeDifference(chegadaPalha, saidaPalha);
                document.getElementById('tempo-palha-calc').textContent = `${tempoPalha} min`;
                
                // Update status
                const statusEl = document.getElementById('tempo-palha-status');
                if (tempoPalha <= configurations.limitePalha) {
                    statusEl.innerHTML = '<span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400">Dentro do limite</span>';
                } else {
                    statusEl.innerHTML = '<span class="px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400">Acima do limite</span>';
                }
            }
            
            // Calculate tempo de pátio
            if (chegadaUsina && saidaPesagem) {
                const tempoPatio = calculateTimeDifference(chegadaUsina, saidaPesagem);
                document.getElementById('tempo-patio-calc').textContent = `${tempoPatio} min`;
                
                // Update status
                const statusEl = document.getElementById('tempo-patio-status');
                if (tempoPatio <= configurations.limitePatio) {
                    statusEl.innerHTML = '<span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400">Dentro do limite</span>';
                } else {
                    statusEl.innerHTML = '<span class="px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400">Acima do limite</span>';
                }
            }
            
            // Show alerts if needed
            updateTimeAlerts();
        }

        function updateTimeAlerts() {
            const alertsContainer = document.getElementById('tempo-alerts');
            const chegadaPalha = document.getElementById('chegada-palha').value;
            const saidaPalha = document.getElementById('saida-palha').value;
            const chegadaUsina = document.getElementById('chegada-usina').value;
            const saidaPesagem = document.getElementById('saida-pesagem').value;
            
            const alerts = [];
            
            // Check tempo de palha
            if (chegadaPalha && saidaPalha) {
                const tempoPalha = calculateTimeDifference(chegadaPalha, saidaPalha);
                if (tempoPalha > configurations.limitePalha) {
                    alerts.push({
                        type: 'warning',
                        message: `Tempo de palha de ${tempoPalha} min excede o limite de ${configurations.limitePalha} min`
                    });
                }
                if (tempoPalha < 0) {
                    alerts.push({
                        type: 'error',
                        message: 'Horário de saída da palha é anterior ao de chegada'
                    });
                }
            }
            
            // Check tempo de pátio
            if (chegadaUsina && saidaPesagem) {
                const tempoPatio = calculateTimeDifference(chegadaUsina, saidaPesagem);
                if (tempoPatio > configurations.limitePatio) {
                    alerts.push({
                        type: 'warning',
                        message: `Tempo de pátio de ${tempoPatio} min excede o limite de ${configurations.limitePatio} min`
                    });
                }
                if (tempoPatio < 0) {
                    alerts.push({
                        type: 'error',
                        message: 'Horário de saída da pesagem é anterior ao de chegada na usina'
                    });
                }
            }
            
            // Check logical sequence
            if (chegadaPalha && saidaPalha && chegadaUsina) {
                if (new Date(chegadaUsina) < new Date(saidaPalha)) {
                    alerts.push({
                        type: 'error',
                        message: 'Chegada na usina não pode ser anterior à saída da palha'
                    });
                }
            }
            
            // Render alerts
            alertsContainer.innerHTML = alerts.map(alert => `
                <div class="flex items-center p-3 rounded-xl ${alert.type === 'error' ? 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800' : 'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800'}">
                    <i class="fas ${alert.type === 'error' ? 'fa-times-circle text-red-500' : 'fa-exclamation-triangle text-yellow-500'} mr-3"></i>
                    <span class="text-sm ${alert.type === 'error' ? 'text-red-700 dark:text-red-400' : 'text-yellow-700 dark:text-yellow-400'}">${alert.message}</span>
                </div>
            `).join('');
        }

        function updateQuickStats() {
            const today = new Date().toDateString();
            const todayEntries = data.filter(entry => new Date(entry.timestamp).toDateString() === today);
            const lastEntry = data.length > 0 ? data[data.length - 1] : null;
            
            // Calculate today's average
            const todayValidPalha = todayEntries.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const todayAvg = todayValidPalha.length > 0 ? 
                todayValidPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / todayValidPalha.length : 0;
            
            // Update stats
            document.getElementById('quick-stats-today').textContent = todayEntries.length;
            document.getElementById('quick-stats-last').textContent = lastEntry ? lastEntry.caminhao : '-';
            document.getElementById('quick-stats-avg').textContent = `${todayAvg.toFixed(1)} min`;
            
            // Update status based on average
            const statusEl = document.getElementById('quick-stats-status');
            if (todayAvg === 0) {
                statusEl.textContent = 'N/A';
                statusEl.className = 'text-lg font-bold text-gray-600 dark:text-gray-400';
            } else if (todayAvg <= configurations.limitePalha) {
                statusEl.textContent = 'OK';
                statusEl.className = 'text-lg font-bold text-green-600 dark:text-green-400';
            } else {
                statusEl.textContent = 'ATENÇÃO';
                statusEl.className = 'text-lg font-bold text-orange-600 dark:text-orange-400';
            }
        }

        function importQuickData() {
            showCustomModal(
                'Importação Rápida',
                'Funcionalidade em desenvolvimento. Em breve você poderá importar dados rapidamente via CSV/Excel.',
                'fas fa-info-circle text-blue-500',
                null
            );
        }

        function duplicateLastEntry() {
            if (data.length === 0) {
                showToast('Nenhum registro anterior para duplicar', 'warning');
                return;
            }
            
            const lastEntry = data[data.length - 1];
            
            // Fill form with last entry data (except timestamps)
            document.getElementById('usina').value = lastEntry.usina;
            document.getElementById('caminhao').value = lastEntry.caminhao;
            document.getElementById('frente-saida').value = lastEntry.frenteSaida;
            
            // Clear time fields - user will need to input new times
            document.getElementById('saida-central').value = '';
            document.getElementById('chegada-palha').value = '';
            document.getElementById('saida-palha').value = '';
            document.getElementById('chegada-usina').value = '';
            document.getElementById('saida-pesagem').value = '';
            
            // Update validation and progress
            setTimeout(() => {
                updateFormProgress();
                showToast('Dados do último registro carregados. Informe os novos horários.', 'info');
            }, 100);
        }

        function updateRecentEntries() {
            const container = document.getElementById('recent-entries');
            const recentData = data.slice(-5).reverse(); // Last 5 entries, most recent first
            
            if (recentData.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        <i class="fas fa-inbox text-2xl mb-4 opacity-50"></i>
                        <p>Nenhum registro recente</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recentData.map((entry, index) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200">
                    <div class="flex items-center flex-1">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-truck text-white text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <span class="font-medium text-gray-900 dark:text-white">${entry.caminhao}</span>
                                <span class="text-xs text-gray-500 dark:text-gray-400">${new Date(entry.timestamp).toLocaleString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Frente ${entry.frenteSaida}</span>
                                <div class="flex items-center space-x-2">
                                    <span class="text-blue-600 dark:text-blue-400">${entry.tempoPalha}min</span>
                                    <span class="text-green-600 dark:text-green-400">${entry.tempoUsina}min</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button onclick="duplicateEntry(${data.length - 1 - index})" class="ml-3 p-2 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded-full hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200">
                        <i class="fas fa-copy text-sm"></i>
                    </button>
                </div>
            `).join('');
        }

        function duplicateEntry(index) {
            editEntry(index);
            showToast('Registro carregado para edição', 'info');
        }

        // Initialize wizard mode
        function initializeWizard() {
            wizardStep = 1;
            updateWizardSteps();
            showWizardStep(1);
        }

        function updateWizardSteps() {
            document.querySelectorAll('.wizard-step').forEach((step, index) => {
                const stepNum = index + 1;
                const stepDiv = step.querySelector('div');
                const stepText = step.querySelector('span');
                
                if (stepNum < wizardStep) {
                    // Completed step
                    stepDiv.className = 'w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center font-bold';
                    stepDiv.innerHTML = '<i class="fas fa-check"></i>';
                    stepText.className = 'mt-2 text-sm font-medium text-green-600 dark:text-green-400';
                } else if (stepNum === wizardStep) {
                    // Current step
                    stepDiv.className = 'w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold';
                    stepDiv.textContent = stepNum;
                    stepText.className = 'mt-2 text-sm font-medium text-blue-600 dark:text-blue-400';
                } else {
                    // Future step
                    stepDiv.className = 'w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 flex items-center justify-center font-bold';
                    stepDiv.textContent = stepNum;
                    stepText.className = 'mt-2 text-sm font-medium text-gray-600 dark:text-gray-400';
                }
            });
            
            // Update navigation buttons
            document.getElementById('wizard-prev').disabled = wizardStep === 1;
            const nextBtn = document.getElementById('wizard-next');
            if (wizardStep === 3) {
                nextBtn.textContent = 'Salvar';
                nextBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Salvar';
            } else {
                nextBtn.innerHTML = 'Próximo<i class="fas fa-arrow-right ml-2"></i>';
            }
        }

        function showWizardStep(step) {
            document.querySelectorAll('.wizard-step-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`wizard-step-${step}`).classList.remove('hidden');
        }

        // Initialize rapid entry mode
        function initializeRapidEntry() {
            rapidEntries = [];
            updateRapidEntriesList();
            populateQuickSelects();
        }

        function populateQuickSelects() {
            const quickFrenteSelect = document.getElementById('quick-frente');
            if (quickFrenteSelect) {
                quickFrenteSelect.innerHTML = '<option value="">Frente</option>' + 
                    frentes.map(frente => `<option value="${frente}">${frente}</option>`).join('');
            }
        }

        function updateRapidEntriesList() {
            const container = document.getElementById('entradas-lote');
            
            if (rapidEntries.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-4">
                        <i class="fas fa-plus-circle text-2xl mb-2 opacity-50"></i>
                        <p class="text-sm">Adicione registros em lote usando o formulário acima</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = rapidEntries.map((entry, index) => `
                <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl">
                    <div class="flex items-center flex-1">
                        <i class="fas fa-truck text-blue-600 mr-3"></i>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <span class="font-medium text-gray-900 dark:text-white">${entry.caminhao}</span>
                                <span class="text-sm text-gray-600 dark:text-gray-400">Frente ${entry.frente}</span>
                            </div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                Palha: ${entry.tempoPalha}min | Pátio: ${entry.tempoPatio}min
                            </div>
                        </div>
                    </div>
                    <button onclick="removeRapidEntry(${index})" class="ml-3 p-2 text-red-400 hover:text-red-600 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20">
                        <i class="fas fa-trash text-sm"></i>
                    </button>
                </div>
            `).join('');
        }

        function removeRapidEntry(index) {
            rapidEntries.splice(index, 1);
            updateRapidEntriesList();
        }

        // Make functions globally available
        window.selectCaminhao = selectCaminhao;
        window.duplicateEntry = duplicateEntry;
        window.removeRapidEntry = removeRapidEntry;

        let filteredData = [];

        function applyFilters() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const dateFrom = document.getElementById('date-from').value;
            const dateTo = document.getElementById('date-to').value;
            const frenteFilter = document.getElementById('frente-filter').value;

            filteredData = data.filter(entry => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    entry.caminhao.toLowerCase().includes(searchTerm) ||
                    entry.usina.toLowerCase().includes(searchTerm);

                // Date range filter
                let matchesDateRange = true;
                if (dateFrom || dateTo) {
                    const entryDate = new Date(entry.timestamp).toISOString().split('T')[0];
                    if (dateFrom && entryDate < dateFrom) matchesDateRange = false;
                    if (dateTo && entryDate > dateTo) matchesDateRange = false;
                }

                // Frente filter
                const matchesFrente = !frenteFilter || entry.frenteSaida === frenteFilter;

                return matchesSearch && matchesDateRange && matchesFrente;
            });

            updateFilteredTable();
            updateFilterStats();
        }

        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('date-from').value = '';
            document.getElementById('date-to').value = '';
            document.getElementById('frente-filter').value = '';
            filteredData = data;
            updateFilteredTable();
            updateFilterStats();
        }

        function updateFilteredTable() {
            const tableBody = document.getElementById('data-table');
            const noDataDiv = document.getElementById('no-data');

            if (filteredData.length === 0) {
                tableBody.innerHTML = '';
                if (data.length === 0) {
                    noDataDiv.classList.remove('hidden');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="11" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400"><i class="fas fa-search text-2xl mb-2"></i><br>Nenhum resultado encontrado com os filtros aplicados</td></tr>';
                    noDataDiv.classList.add('hidden');
                }
                return;
            }

            noDataDiv.classList.add('hidden');
            
            tableBody.innerHTML = filteredData.map((entry, index) => {
                const originalIndex = data.indexOf(entry);
                return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${entry.usina}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${entry.caminhao}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.saidaCentral)}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.chegadaPalha)}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.saidaPalha)}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold ${entry.tempoPalha > 40 ? 'text-red-600' : 'text-green-600'}">${entry.tempoPalha}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.chegadaUsina)}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${formatDateTime(entry.saidaPesagem)}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold ${entry.tempoUsina > 40 ? 'text-red-600' : 'text-green-600'}">${entry.tempoUsina}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${entry.frenteSaida}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm font-medium no-print">
                            <button onclick="editEntry(${originalIndex})" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 mr-3">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteEntry(${originalIndex})" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateFilterStats() {
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 40);
            const validUsinaData = filteredData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 40);

            const avgPalha = validPalhaData.length > 0 ? 
                (validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length).toFixed(1) : 0;
            
            const avgUsina = validUsinaData.length > 0 ? 
                (validUsinaData.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsinaData.length).toFixed(1) : 0;

            document.getElementById('filtered-count').textContent = filteredData.length;
            document.getElementById('filtered-avg-palha').textContent = avgPalha + ' min';
            document.getElementById('filtered-avg-patio').textContent = avgUsina + ' min';
        }

        function toggleExportDropdown() {
            const dropdown = document.getElementById('export-dropdown');
            dropdown.classList.toggle('hidden');
        }

        function hideExportDropdown() {
            document.getElementById('export-dropdown').classList.add('hidden');
        }

        function exportData(format) {
            if (filteredData.length === 0) {
                showToast('Nenhum dado para exportar', 'warning');
                return;
            }

            const exportData = filteredData.length > 0 ? filteredData : data;

            switch (format) {
                case 'csv':
                    exportToCSVAdvanced(exportData);
                    break;
                case 'excel':
                    exportToExcel(exportData);
                    break;
                case 'pdf':
                    exportToPDF(exportData);
                    break;
            }
        }

        function exportToCSVAdvanced(exportData) {
            const headers = [
                'Usina', 'Caminhão', 'Dt./Hr. Saida Central Trafego', 'Dt./Hr. Chegada Palha',
                'Dt hr saida palha', 'tempo de palha (minutos)', 'Dt./Hr. Chegada Usina',
                'Dt./Hr. Saída Pesagem', 'tempo de usina (minutos)', 'Frente saida'
            ];

            const csvContent = [
                headers.join(','),
                ...exportData.map(entry => [
                    `"${entry.usina}"`,
                    `"${entry.caminhao}"`,
                    `"${entry.saidaCentral}"`,
                    `"${entry.chegadaPalha}"`,
                    `"${entry.saidaPalha}"`,
                    entry.tempoPalha,
                    `"${entry.chegadaUsina}"`,
                    `"${entry.saidaPesagem}"`,
                    entry.tempoUsina,
                    entry.frenteSaida
                ].join(','))
            ].join('\n');

            downloadFile(csvContent, 'text/csv', 'csv');
            showToast('Arquivo CSV exportado com sucesso!', 'success');
        }

        function exportToExcel(exportData) {
            const headers = [
                'Usina', 'Caminhão', 'Dt./Hr. Saida Central', 'Dt./Hr. Chegada Palha',
                'Dt./Hr. Saida Palha', 'Tempo Palha (min)', 'Dt./Hr. Chegada Usina',
                'Dt./Hr. Saída Pesagem', 'Tempo Usina (min)', 'Frente'
            ];

            const worksheetData = [
                headers,
                ...exportData.map(entry => [
                    entry.usina,
                    entry.caminhao,
                    entry.saidaCentral,
                    entry.chegadaPalha,
                    entry.saidaPalha,
                    entry.tempoPalha,
                    entry.chegadaUsina,
                    entry.saidaPesagem,
                    entry.tempoUsina,
                    entry.frenteSaida
                ])
            ];

            const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Tempo Pátio e Palha');

            const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
            const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `tempo_patio_palha_${new Date().toISOString().split('T')[0]}.xlsx`;
            link.click();

            showToast('Arquivo Excel exportado com sucesso!', 'success');
        }

        function exportToPDF(exportData) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4'); // landscape orientation

            // Title
            doc.setFontSize(16);
            doc.text('Relatório - Tempo de Pátio e Palha', 20, 20);
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 20, 30);
            doc.text(`Total de registros: ${exportData.length}`, 20, 35);

            // Table headers
            const headers = ['Usina', 'Caminhão', 'Saída Central', 'Chegada Palha', 'Saída Palha', 'Tempo Palha', 'Chegada Usina', 'Saída Pesagem', 'Tempo Usina', 'Frente'];
            
            let y = 50;
            doc.setFontSize(8);

            // Draw headers
            let x = 10;
            const colWidths = [20, 20, 25, 25, 25, 20, 25, 25, 20, 15];
            headers.forEach((header, i) => {
                doc.rect(x, y - 5, colWidths[i], 10);
                doc.text(header, x + 2, y);
                x += colWidths[i];
            });

            // Draw data
            y += 10;
            exportData.slice(0, 30).forEach((entry, index) => { // Limit to 30 records for PDF
                x = 10;
                const row = [
                    entry.usina,
                    entry.caminhao,
                    formatDateTimeShort(entry.saidaCentral),
                    formatDateTimeShort(entry.chegadaPalha),
                    formatDateTimeShort(entry.saidaPalha),
                    entry.tempoPalha.toString(),
                    formatDateTimeShort(entry.chegadaUsina),
                    formatDateTimeShort(entry.saidaPesagem),
                    entry.tempoUsina.toString(),
                    entry.frenteSaida
                ];

                row.forEach((cell, i) => {
                    doc.rect(x, y - 5, colWidths[i], 8);
                    doc.text(cell.substring(0, 12), x + 1, y);
                    x += colWidths[i];
                });
                y += 8;

                if (y > 180) {
                    doc.addPage();
                    y = 20;
                }
            });

            if (exportData.length > 30) {
                doc.text(`... e mais ${exportData.length - 30} registros`, 20, y + 10);
            }

            doc.save(`tempo_patio_palha_${new Date().toISOString().split('T')[0]}.pdf`);
            showToast('Arquivo PDF exportado com sucesso!', 'success');
        }

        function formatDateTimeShort(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }) + ' ' + 
                   date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        function downloadFile(content, mimeType, extension) {
            const blob = new Blob([content], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `tempo_patio_palha_${new Date().toISOString().split('T')[0]}.${extension}`;
            link.click();
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.xlsx,.xls';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        let importedData = [];
                        
                        if (file.name.endsWith('.csv')) {
                            importedData = parseCSV(e.target.result);
                        } else {
                            const workbook = XLSX.read(e.target.result, { type: 'binary' });
                            const sheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            importedData = parseExcelData(jsonData);
                        }

                        if (importedData.length > 0) {
                            showCustomModal(
                                'Confirmar Importação',
                                `Foram encontrados ${importedData.length} registros. Deseja importar todos os dados?`,
                                'fas fa-upload text-blue-500',
                                function() {
                                    data = [...data, ...importedData];
                                    saveData();
                                    updateDataTable();
                                    updateReports();
                                    updateDashboard();
                                    showToast(`${importedData.length} registros importados com sucesso!`, 'success');
                                }
                            );
                        } else {
                            showToast('Nenhum dado válido encontrado no arquivo', 'warning');
                        }
                    } catch (error) {
                        showToast('Erro ao importar arquivo: ' + error.message, 'error');
                    }
                };

                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsBinaryString(file);
                }
            };
            input.click();
        }

        function parseCSV(csvContent) {
            const lines = csvContent.split('\n');
            const result = [];
            
            for (let i = 1; i < lines.length; i++) { // Skip header
                const line = lines[i].trim();
                if (!line) continue;
                
                const columns = line.split(',').map(col => col.replace(/"/g, '').trim());
                if (columns.length >= 10) {
                    const entry = createEntryFromImport(columns);
                    if (entry) result.push(entry);
                }
            }
            
            return result;
        }

        function parseExcelData(jsonData) {
            const result = [];
            
            for (let i = 1; i < jsonData.length; i++) { // Skip header
                const row = jsonData[i];
                if (row && row.length >= 10) {
                    const entry = createEntryFromImport(row);
                    if (entry) result.push(entry);
                }
            }
            
            return result;
        }

        function createEntryFromImport(columns) {
            try {
                const entry = {
                    usina: columns[0] || '4 CAMBUI',
                    caminhao: columns[1],
                    saidaCentral: columns[2],
                    chegadaPalha: columns[3],
                    saidaPalha: columns[4],
                    tempoPalha: parseInt(columns[5]) || 0,
                    chegadaUsina: columns[6],
                    saidaPesagem: columns[7],
                    tempoUsina: parseInt(columns[8]) || 0,
                    frenteSaida: columns[9],
                    timestamp: new Date().toISOString()
                };

                // Validate required fields
                if (!entry.caminhao || !entry.frenteSaida) {
                    return null;
                }

                return entry;
            } catch (error) {
                return null;
            }
        }

        function backupData() {
            if (data.length === 0) {
                showToast('Nenhum dado para fazer backup', 'warning');
                return;
            }

            const backupData = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                data: data,
                count: data.length
            };

            const backupContent = JSON.stringify(backupData, null, 2);
            downloadFile(backupContent, 'application/json', 'json');
            showToast('Backup realizado com sucesso!', 'success');
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        if (backupData.data && Array.isArray(backupData.data)) {
                            showCustomModal(
                                'Confirmar Restauração',
                                `O backup contém ${backupData.count} registros de ${new Date(backupData.timestamp).toLocaleString('pt-BR')}. Isso substituirá todos os dados atuais. Continuar?`,
                                'fas fa-exclamation-triangle text-orange-500',
                                function() {
                                    data = backupData.data;
                                    saveData();
                                    updateDataTable();
                                    updateReports();
                                    updateDashboard();
                                    showToast('Dados restaurados com sucesso!', 'success');
                                }
                            );
                        } else {
                            showToast('Arquivo de backup inválido', 'error');
                        }
                    } catch (error) {
                        showToast('Erro ao ler arquivo de backup: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Initialize filtered data and apply filters on load
        filteredData = data;
        document.addEventListener('DOMContentLoaded', function() {
            applyFilters();
            loadConfigurations();
            updateSystemInfo();
            setupConfigurationListeners();
            loadFrentes();
        });

        // Override updateDataTable to use filtered data
        const originalUpdateDataTable = updateDataTable;
        updateDataTable = function() {
            if (document.getElementById('visualizar-tab').classList.contains('hidden')) {
                originalUpdateDataTable();
            } else {
                applyFilters();
            }
        };

        // Configuration Management
        let frentes = JSON.parse(localStorage.getItem('patiopalha-frentes') || '["4001", "4002", "4009", "4010"]');
        let configurations = JSON.parse(localStorage.getItem('patiopalha-config') || '{"usinaPadrao": "4 CAMBUI", "limitePalha": 40, "limitePatio": 40}');

        function setupConfigurationListeners() {
            // Gerenciar Frentes
            document.getElementById('add-frente').addEventListener('click', addFrente);
            document.getElementById('nova-frente').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addFrente();
                }
            });

            // Backup e Restore Completo
            document.getElementById('export-backup-complete').addEventListener('click', exportBackupComplete);
            document.getElementById('import-backup-complete').addEventListener('click', importBackupComplete);
            document.getElementById('clear-all-data-config').addEventListener('click', clearAllDataConfig);

            // Salvar Configurações
            document.getElementById('save-config').addEventListener('click', saveConfigurations);

            // Atualizar informações do sistema quando mudar de aba
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.dataset.tab === 'configuracoes') {
                        updateSystemInfo();
                    }
                });
            });
        }

        function loadConfigurations() {
            document.getElementById('config-usina-padrao').value = configurations.usinaPadrao;
            document.getElementById('config-limite-palha').value = configurations.limitePalha;
            document.getElementById('config-limite-patio').value = configurations.limitePatio;
            
            // Atualizar campo usina padrão no formulário
            document.getElementById('usina').value = configurations.usinaPadrao;
        }

        function saveConfigurations() {
            configurations = {
                usinaPadrao: document.getElementById('config-usina-padrao').value,
                limitePalha: parseInt(document.getElementById('config-limite-palha').value),
                limitePatio: parseInt(document.getElementById('config-limite-patio').value)
            };

            localStorage.setItem('patiopalha-config', JSON.stringify(configurations));
            
            // Atualizar campo usina padrão no formulário
            document.getElementById('usina').value = configurations.usinaPadrao;
            
            showToast('Configurações salvas com sucesso!', 'success');
            updateSystemInfo();
        }

        function loadFrentes() {
            updateFrenteSelects();
            updateFrentesList();
        }

        function updateFrenteSelects() {
            const frenteSelects = ['frente-saida', 'frente-filter'];
            
            frenteSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;
                
                // Limpar opções existentes (exceto a primeira)
                while (select.children.length > 1) {
                    select.removeChild(select.lastChild);
                }
                
                // Adicionar frentes
                frentes.forEach(frente => {
                    const option = document.createElement('option');
                    option.value = frente;
                    option.textContent = frente;
                    select.appendChild(option);
                });
                
                // Restaurar valor selecionado se ainda existir
                if (frentes.includes(currentValue)) {
                    select.value = currentValue;
                }
            });
        }

        function updateFrentesList() {
            const frentesList = document.getElementById('frentes-list');
            
            frentesList.innerHTML = frentes.map(frente => `
                <div class="flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-3 rounded-xl">
                    <div class="flex items-center">
                        <i class="fas fa-road text-blue-600 mr-3"></i>
                        <span class="font-medium text-gray-900 dark:text-white">Frente ${frente}</span>
                    </div>
                    <button onclick="removeFrente('${frente}')" 
                            class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 p-2 rounded-full hover:bg-red-100 dark:hover:bg-red-900/20 transition-all duration-200">
                        <i class="fas fa-trash text-sm"></i>
                    </button>
                </div>
            `).join('');
        }

        function addFrente() {
            const novaFrenteInput = document.getElementById('nova-frente');
            const novaFrente = novaFrenteInput.value.trim();
            
            if (!novaFrente) {
                showToast('Digite o nome da frente', 'warning');
                return;
            }
            
            if (frentes.includes(novaFrente)) {
                showToast('Esta frente já está cadastrada', 'warning');
                return;
            }
            
            frentes.push(novaFrente);
            frentes.sort(); // Manter ordenado
            
            localStorage.setItem('patiopalha-frentes', JSON.stringify(frentes));
            
            updateFrenteSelects();
            updateFrentesList();
            updateSystemInfo();
            createDynamicReportSections();
            
            // Atualizar dashboard se houver dados
            if (data.length > 0) {
                updateDashboard();
                updateReports();
            }
            
            novaFrenteInput.value = '';
            showToast(`Frente ${novaFrente} adicionada com sucesso!`, 'success');
        }

        function removeFrente(frente) {
            // Verificar se a frente está sendo usada
            const frenteEmUso = data.some(entry => entry.frenteSaida === frente);
            
            if (frenteEmUso) {
                showCustomModal(
                    'Frente em Uso',
                    `A frente ${frente} possui registros associados. Remover mesmo assim? Os registros não serão excluídos.`,
                    'fas fa-exclamation-triangle text-orange-500',
                    function() {
                        executeRemoveFrente(frente);
                    }
                );
            } else {
                showCustomModal(
                    'Confirmar Remoção',
                    `Tem certeza que deseja remover a frente ${frente}?`,
                    'fas fa-question-circle text-blue-500',
                    function() {
                        executeRemoveFrente(frente);
                    }
                );
            }
        }

        function executeRemoveFrente(frente) {
            frentes = frentes.filter(f => f !== frente);
            localStorage.setItem('patiopalha-frentes', JSON.stringify(frentes));
            
            updateFrenteSelects();
            updateFrentesList();
            updateSystemInfo();
            
            showToast(`Frente ${frente} removida com sucesso!`, 'success');
        }

        function exportBackupComplete() {
            const completeBackup = {
                version: '2.0',
                timestamp: new Date().toISOString(),
                data: {
                    registros: data,
                    frentes: frentes,
                    configuracoes: configurations
                },
                stats: {
                    totalRegistros: data.length,
                    totalFrente: frentes.length,
                    dataInicio: data.length > 0 ? data[0].timestamp : null,
                    dataFim: data.length > 0 ? data[data.length - 1].timestamp : null
                }
            };

            const backupContent = JSON.stringify(completeBackup, null, 2);
            
            const blob = new Blob([backupContent], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `backup_completo_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            // Salvar informação do último backup
            localStorage.setItem('patiopalha-last-backup', new Date().toISOString());
            updateSystemInfo();
            
            showToast('Backup completo exportado com sucesso!', 'success');
        }

        function importBackupComplete() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        // Verificar estrutura do backup
                        if (!backupData.data || !backupData.version) {
                            showToast('Arquivo de backup inválido ou corrompido', 'error');
                            return;
                        }

                        const stats = backupData.stats || {};
                        
                        showCustomModal(
                            'Confirmar Importação Completa',
                            `Este backup contém:
                            • ${stats.totalRegistros || 0} registros
                            • ${stats.totalFrente || 0} frentes
                            • Configurações do sistema
                            
                            ATENÇÃO: Todos os dados atuais serão substituídos!`,
                            'fas fa-exclamation-triangle text-red-500',
                            function() {
                                // Importar todos os dados
                                if (backupData.data.registros) {
                                    data = backupData.data.registros;
                                    localStorage.setItem('patiopalha-data', JSON.stringify(data));
                                }
                                
                                if (backupData.data.frentes) {
                                    frentes = backupData.data.frentes;
                                    localStorage.setItem('patiopalha-frentes', JSON.stringify(frentes));
                                }
                                
                                if (backupData.data.configuracoes) {
                                    configurations = backupData.data.configuracoes;
                                    localStorage.setItem('patiopalha-config', JSON.stringify(configurations));
                                }
                                
                                // Atualizar interface
                                loadConfigurations();
                                loadFrentes();
                                updateDataTable();
                                updateReports();
                                updateDashboard();
                                updateSystemInfo();
                                
                                showToast('Backup importado com sucesso!', 'success');
                            }
                        );
                        
                    } catch (error) {
                        showToast('Erro ao ler arquivo de backup: ' + error.message, 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearAllDataConfig() {
            showCustomModal(
                'ATENÇÃO: Operação Irreversível',
                'Esta ação irá excluir PERMANENTEMENTE todos os dados, frentes e configurações do sistema. Esta operação NÃO PODE SER DESFEITA! Tem absoluta certeza?',
                'fas fa-skull-crossbones text-red-600',
                function() {
                    // Mostrar segundo modal de confirmação
                    showCustomModal(
                        'Última Confirmação',
                        'Digite "CONFIRMAR" no campo abaixo para prosseguir com a exclusão total:',
                        'fas fa-exclamation-triangle text-red-500',
                        function() {
                            // Criar modal customizado para input
                            const modalDiv = document.createElement('div');
                            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                            modalDiv.innerHTML = `
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Digite CONFIRMAR:</h3>
                                    <input type="text" id="confirm-input" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500 text-base" placeholder="Digite: CONFIRMAR">
                                    <div class="flex justify-end space-x-3 mt-4">
                                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancelar</button>
                                        <button onclick="validateAndClearAll()" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Confirmar</button>
                                    </div>
                                </div>
                            `;
                            document.body.appendChild(modalDiv);
                            document.getElementById('confirm-input').focus();
                        }
                    );
                }
            );
        }

        function validateAndClearAll() {
            const confirmInput = document.getElementById('confirm-input');
            if (confirmInput && confirmInput.value === 'CONFIRMAR') {
                // Excluir todos os dados
                data = [];
                frentes = ["4001", "4002", "4009", "4010"]; // Resetar para padrão
                configurations = {"usinaPadrao": "4 CAMBUI", "limitePalha": 40, "limitePatio": 40}; // Resetar para padrão
                
                // Limpar localStorage
                localStorage.removeItem('patiopalha-data');
                localStorage.removeItem('patiopalha-frentes');
                localStorage.removeItem('patiopalha-config');
                localStorage.removeItem('patiopalha-last-backup');
                
                // Salvar dados padrão
                localStorage.setItem('patiopalha-frentes', JSON.stringify(frentes));
                localStorage.setItem('patiopalha-config', JSON.stringify(configurations));
                
                // Atualizar interface
                loadConfigurations();
                loadFrentes();
                updateDataTable();
                updateReports();
                updateDashboard();
                updateSystemInfo();
                
                // Fechar modal
                document.querySelector('.fixed').remove();
                
                showToast('Todos os dados foram excluídos e o sistema foi resetado!', 'success');
            } else {
                showToast('Confirmação incorreta. Digite exatamente: CONFIRMAR', 'error');
            }
        }

        function updateSystemInfo() {
            // Total de registros
            document.getElementById('info-total-records').textContent = data.length;
            
            // Total de frentes
            document.getElementById('info-total-frentes').textContent = frentes.length;
            
            // Último backup
            const lastBackup = localStorage.getItem('patiopalha-last-backup');
            if (lastBackup) {
                const backupDate = new Date(lastBackup);
                document.getElementById('info-last-backup').textContent = backupDate.toLocaleDateString('pt-BR') + ' ' + backupDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            } else {
                document.getElementById('info-last-backup').textContent = 'Nunca';
            }
        }

        function createDynamicReportSections() {
            // Esta função criará seções de relatório dinâmicas para novas frentes
            // Primeiro, vamos pegar o container dos relatórios
            const relatoriosContainer = document.querySelector('#relatorios-tab .grid');
            
            // Limpar relatórios existentes (só as frentes dinâmicas)
            const existingSections = relatoriosContainer.querySelectorAll('[data-dynamic-frente]');
            existingSections.forEach(section => section.remove());
            
            // Cores disponíveis para os ícones das frentes
            const iconColors = ['text-blue-600', 'text-green-600', 'text-purple-600', 'text-yellow-600', 'text-red-600', 'text-indigo-600', 'text-pink-600', 'text-cyan-600'];
            
            // Crear seções para frentes que não existem nos elementos fixos
            const defaultFrentes = ['4001', '4002', '4009', '4010'];
            const newFrentes = frentes.filter(frente => !defaultFrentes.includes(frente));
            
            newFrentes.forEach((frente, index) => {
                const colorClass = iconColors[index % iconColors.length];
                
                const reportSection = document.createElement('div');
                reportSection.className = 'bg-white dark:bg-gray-800 shadow rounded-lg p-6';
                reportSection.setAttribute('data-dynamic-frente', frente);
                
                reportSection.innerHTML = `
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-chart-bar mr-2 ${colorClass}"></i>Frente ${frente}
                    </h3>
                    <div id="report-${frente}" class="space-y-4">
                        <!-- Report content will be populated here -->
                    </div>
                `;
                
                relatoriosContainer.appendChild(reportSection);
            });
        }

        // Advanced Reports Functions
        function setupReportsListeners() {
            document.getElementById('report-period').addEventListener('change', updateAdvancedReports);
            document.getElementById('report-type').addEventListener('change', switchReportView);
            document.getElementById('refresh-reports').addEventListener('click', refreshReports);
            document.getElementById('export-report').addEventListener('click', exportReportToPDF);
        }

        function updateAdvancedReports() {
            const period = document.getElementById('report-period').value;
            const reportType = document.getElementById('report-type').value;
            
            const filteredData = getFilteredDataByPeriod(period);
            
            generateExecutiveSummary(filteredData);
            generateAdvancedCharts(filteredData);
            
            if (reportType === 'detailed') {
                generateDetailedReports(filteredData);
            } else if (reportType === 'summary') {
                generateSummaryReports(filteredData);
            } else if (reportType === 'comparison') {
                generateComparisonReports(filteredData);
            } else if (reportType === 'performance') {
                generatePerformanceReports(filteredData);
            }
        }

        function switchReportView() {
            const reportType = document.getElementById('report-type').value;
            
            // Hide all report views
            document.querySelectorAll('.report-view').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Show selected view
            document.getElementById(`${reportType}-reports`).classList.remove('hidden');
            
            updateAdvancedReports();
        }

        function refreshReports() {
            const btn = document.getElementById('refresh-reports');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Atualizando...';
            
            setTimeout(() => {
                updateAdvancedReports();
                btn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>Atualizar';
                showToast('Relatórios atualizados!', 'success');
            }, 1000);
        }

        function generateExecutiveSummary(filteredData) {
            const container = document.getElementById('executive-summary');
            
            // Calculate KPIs
            const totalTrips = filteredData.length;
            const today = new Date().toDateString();
            const todayTrips = filteredData.filter(entry => new Date(entry.timestamp).toDateString() === today).length;
            
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const validUsinaData = filteredData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 60);
            
            const avgPalha = validPalhaData.length > 0 ? 
                validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length : 0;
            
            const efficiency = filteredData.length > 0 ? 
                (validPalhaData.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalhaData.length) * 100 : 0;

            const activeFronts = [...new Set(filteredData.map(entry => entry.frenteSaida))].length;

            container.innerHTML = `
                <div class="stat-card p-6 rounded-3xl card-hover animate-float">
                    <div class="text-center">
                        <div class="relative inline-block mb-4">
                            <div class="absolute -inset-1 bg-blue-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-full">
                                <i class="fas fa-truck text-white text-2xl"></i>
                            </div>
                        </div>
                        <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2">Total de Viagens</h4>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">${totalTrips}</p>
                        <p class="text-sm text-green-600 dark:text-green-400 font-medium mt-2">+${todayTrips} hoje</p>
                    </div>
                </div>

                <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.1s;">
                    <div class="text-center">
                        <div class="relative inline-block mb-4">
                            <div class="absolute -inset-1 bg-purple-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-full">
                                <i class="fas fa-clock text-white text-2xl"></i>
                            </div>
                        </div>
                        <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2">Tempo Médio Palha</h4>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">${avgPalha.toFixed(1)} min</p>
                        <p class="text-sm ${avgPalha <= configurations.limitePalha ? 'text-green-600' : 'text-red-600'} dark:text-green-400 font-medium mt-2">
                            ${avgPalha <= configurations.limitePalha ? 'Dentro do limite' : 'Acima do limite'}
                        </p>
                    </div>
                </div>

                <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.2s;">
                    <div class="text-center">
                        <div class="relative inline-block mb-4">
                            <div class="absolute -inset-1 bg-green-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-full">
                                <i class="fas fa-target text-white text-2xl"></i>
                            </div>
                        </div>
                        <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2">Eficiência</h4>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">${efficiency.toFixed(1)}%</p>
                        <p class="text-sm ${efficiency >= 85 ? 'text-green-600' : 'text-orange-600'} dark:text-green-400 font-medium mt-2">
                            ${efficiency >= 85 ? 'Excelente' : 'Pode melhorar'}
                        </p>
                    </div>
                </div>

                <div class="stat-card p-6 rounded-3xl card-hover animate-float" style="animation-delay: 0.3s;">
                    <div class="text-center">
                        <div class="relative inline-block mb-4">
                            <div class="absolute -inset-1 bg-orange-500 rounded-full pulse-ring opacity-30"></div>
                            <div class="relative bg-gradient-to-r from-orange-500 to-orange-600 p-4 rounded-full">
                                <i class="fas fa-road text-white text-2xl"></i>
                            </div>
                        </div>
                        <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-2">Frentes Ativas</h4>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">${activeFronts}</p>
                        <p class="text-sm text-blue-600 dark:text-blue-400 font-medium mt-2">de ${frentes.length} total</p>
                    </div>
                </div>
            `;
        }

        function generateAdvancedCharts(filteredData) {
            // Performance Overview Chart
            generatePerformanceOverviewChart(filteredData);
            
            // Efficiency Trends Chart
            generateEfficiencyTrendsChart(filteredData);
        }

        function generatePerformanceOverviewChart(filteredData) {
            const ctx = document.getElementById('report-performance-chart');
            if (!ctx) return;

            // Destroy existing chart
            if (charts.reportPerformance) {
                charts.reportPerformance.destroy();
            }

            const frenteData = frentes.map(frente => {
                const frenteEntries = filteredData.filter(entry => entry.frenteSaida === frente);
                const validPalha = frenteEntries.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const validUsina = frenteEntries.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 60);
                
                return {
                    frente,
                    avgPalha: validPalha.length > 0 ? validPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalha.length : 0,
                    avgUsina: validUsina.length > 0 ? validUsina.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsina.length : 0,
                    count: frenteEntries.length
                };
            }).filter(item => item.count > 0);

            charts.reportPerformance = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: frenteData.map(f => f.frente),
                    datasets: [
                        {
                            label: 'Tempo Palha (min)',
                            data: frenteData.map(f => f.avgPalha.toFixed(1)),
                            backgroundColor: '#3B82F6',
                            borderColor: '#1D4ED8',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false,
                        },
                        {
                            label: 'Tempo Pátio (min)',
                            data: frenteData.map(f => f.avgUsina.toFixed(1)),
                            backgroundColor: '#10B981',
                            borderColor: '#047857',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#6366F1',
                            borderWidth: 1,
                            callbacks: {
                                afterBody: function(context) {
                                    const index = context[0].dataIndex;
                                    const frente = frenteData[index];
                                    return [`Total de viagens: ${frente.count}`];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tempo (minutos)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutCubic'
                    }
                }
            });
        }

        function generateEfficiencyTrendsChart(filteredData) {
            const ctx = document.getElementById('report-efficiency-chart');
            if (!ctx) return;

            // Destroy existing chart
            if (charts.reportEfficiency) {
                charts.reportEfficiency.destroy();
            }

            // Get last 7 days
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date.toDateString());
            }

            const efficiencyData = last7Days.map(dateStr => {
                const dayData = filteredData.filter(entry => new Date(entry.timestamp).toDateString() === dateStr);
                const validPalha = dayData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= configurations.limitePalha);
                const totalPalha = dayData.filter(entry => entry.tempoPalha > 0);
                
                const efficiency = totalPalha.length > 0 ? (validPalha.length / totalPalha.length) * 100 : 0;
                
                return {
                    date: new Date(dateStr).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' }),
                    efficiency: efficiency,
                    total: dayData.length
                };
            });

            charts.reportEfficiency = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: efficiencyData.map(d => d.date),
                    datasets: [
                        {
                            label: 'Eficiência (%)',
                            data: efficiencyData.map(d => d.efficiency.toFixed(1)),
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#8B5CF6',
                            pointBorderColor: '#FFFFFF',
                            pointBorderWidth: 2,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#8B5CF6',
                            borderWidth: 1,
                            callbacks: {
                                afterBody: function(context) {
                                    const index = context[0].dataIndex;
                                    const data = efficiencyData[index];
                                    return [`Total de registros: ${data.total}`];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Eficiência (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutCubic'
                    }
                }
            });
        }

        function generateDetailedReports(filteredData) {
            const container = document.getElementById('front-reports-grid');
            
            container.innerHTML = frentes.map((frente, index) => {
                const frenteData = filteredData.filter(entry => entry.frenteSaida === frente);
                
                if (frenteData.length === 0) {
                    return `
                        <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                            <div class="flex items-center mb-6">
                                <div class="relative">
                                    <div class="absolute -inset-1 bg-gray-400 rounded-full blur-sm opacity-50"></div>
                                    <div class="relative bg-gradient-to-r from-gray-400 to-gray-500 p-3 rounded-full">
                                        <i class="fas fa-road text-white text-lg"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">Frente ${frente}</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Sem dados no período</p>
                                </div>
                            </div>
                            <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                                <i class="fas fa-inbox text-3xl mb-4 opacity-50"></i>
                                <p>Nenhum registro encontrado</p>
                            </div>
                        </div>
                    `;
                }

                // Calculate statistics
                const validPalha = frenteData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const validUsina = frenteData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 60);
                
                const avgPalha = validPalha.length > 0 ? validPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalha.length : 0;
                const avgUsina = validUsina.length > 0 ? validUsina.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsina.length : 0;
                
                const efficiency = validPalha.length > 0 ? (validPalha.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalha.length) * 100 : 0;
                
                // Calculate productivity (trips per day)
                const days = Math.max(1, (new Date() - new Date(Math.min(...frenteData.map(entry => new Date(entry.timestamp))))) / (1000 * 60 * 60 * 24));
                const productivity = frenteData.length / days;

                const colors = ['blue', 'green', 'purple', 'yellow', 'red', 'indigo', 'pink', 'cyan'];
                const color = colors[index % colors.length];

                return `
                    <div class="chart-container shadow-2xl rounded-3xl p-6 card-hover">
                        <div class="flex items-center mb-6">
                            <div class="relative">
                                <div class="absolute -inset-1 bg-${color}-500 rounded-full blur-sm opacity-50"></div>
                                <div class="relative bg-gradient-to-r from-${color}-500 to-${color}-600 p-3 rounded-full">
                                    <i class="fas fa-road text-white text-lg"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">Frente ${frente}</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${frenteData.length} viagens</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-2xl">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs text-blue-600 dark:text-blue-400 font-medium uppercase tracking-wider">Tempo Palha</p>
                                        <p class="text-2xl font-bold text-blue-700 dark:text-blue-300">${avgPalha.toFixed(1)} min</p>
                                    </div>
                                    <i class="fas fa-clock text-blue-500 text-xl"></i>
                                </div>
                            </div>

                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-2xl">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs text-green-600 dark:text-green-400 font-medium uppercase tracking-wider">Tempo Pátio</p>
                                        <p class="text-2xl font-bold text-green-700 dark:text-green-300">${avgUsina.toFixed(1)} min</p>
                                    </div>
                                    <i class="fas fa-chart-line text-green-500 text-xl"></i>
                                </div>
                            </div>

                            <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-2xl">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs text-purple-600 dark:text-purple-400 font-medium uppercase tracking-wider">Eficiência</p>
                                        <p class="text-2xl font-bold text-purple-700 dark:text-purple-300">${efficiency.toFixed(1)}%</p>
                                    </div>
                                    <i class="fas fa-target text-purple-500 text-xl"></i>
                                </div>
                            </div>

                            <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-2xl">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xs text-orange-600 dark:text-orange-400 font-medium uppercase tracking-wider">Produtividade</p>
                                        <p class="text-2xl font-bold text-orange-700 dark:text-orange-300">${productivity.toFixed(1)}/dia</p>
                                    </div>
                                    <i class="fas fa-tachometer-alt text-orange-500 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Status de Performance:</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${efficiency >= 85 ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400' : efficiency >= 70 ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400' : 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400'}">
                                    ${efficiency >= 85 ? 'Excelente' : efficiency >= 70 ? 'Bom' : 'Precisa Melhorar'}
                                </span>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Registros válidos:</span>
                                <span class="font-medium text-gray-900 dark:text-white">${validPalha.length} de ${frenteData.length}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function generateSummaryReports(filteredData) {
            generateKPISummary(filteredData);
            generateCriticalInsights(filteredData);
            generateRecommendations(filteredData);
        }

        function generateKPISummary(filteredData) {
            const container = document.getElementById('kpi-summary-content');
            
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const avgPalha = validPalhaData.length > 0 ? validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length : 0;
            const efficiency = validPalhaData.length > 0 ? (validPalhaData.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalhaData.length) * 100 : 0;
            
            const totalTrips = filteredData.length;
            const avgTripsPerDay = totalTrips / Math.max(1, document.getElementById('report-period').value === 'all' ? 30 : parseInt(document.getElementById('report-period').value));

            container.innerHTML = `
                <div class="space-y-6">
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-2xl">
                        <div>
                            <h4 class="text-lg font-bold text-blue-700 dark:text-blue-300">Tempo Médio de Palha</h4>
                            <p class="text-3xl font-bold text-blue-900 dark:text-blue-100">${avgPalha.toFixed(1)} min</p>
                            <p class="text-sm text-blue-600 dark:text-blue-400">Meta: ≤ ${configurations.limitePalha} min</p>
                        </div>
                        <div class="text-right">
                            <div class="w-16 h-16 rounded-full bg-blue-500 flex items-center justify-center">
                                <i class="fas fa-clock text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-2xl">
                        <div>
                            <h4 class="text-lg font-bold text-green-700 dark:text-green-300">Taxa de Eficiência</h4>
                            <p class="text-3xl font-bold text-green-900 dark:text-green-100">${efficiency.toFixed(1)}%</p>
                            <p class="text-sm text-green-600 dark:text-green-400">Meta: ≥ 85%</p>
                        </div>
                        <div class="text-right">
                            <div class="w-16 h-16 rounded-full bg-green-500 flex items-center justify-center">
                                <i class="fas fa-target text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-2xl">
                        <div>
                            <h4 class="text-lg font-bold text-purple-700 dark:text-purple-300">Produtividade Média</h4>
                            <p class="text-3xl font-bold text-purple-900 dark:text-purple-100">${avgTripsPerDay.toFixed(1)} viagens/dia</p>
                            <p class="text-sm text-purple-600 dark:text-purple-400">Total: ${totalTrips} viagens</p>
                        </div>
                        <div class="text-right">
                            <div class="w-16 h-16 rounded-full bg-purple-500 flex items-center justify-center">
                                <i class="fas fa-chart-line text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCriticalInsights(filteredData) {
            const container = document.getElementById('critical-insights-content');
            
            const insights = [];
            
            // Performance insights
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const avgPalha = validPalhaData.length > 0 ? validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length : 0;
            
            if (avgPalha > configurations.limitePalha) {
                insights.push({
                    type: 'warning',
                    icon: 'fas fa-exclamation-triangle',
                    title: 'Tempo de Palha Elevado',
                    description: `Média de ${avgPalha.toFixed(1)} min excede o limite de ${configurations.limitePalha} min em ${((avgPalha - configurations.limitePalha) / configurations.limitePalha * 100).toFixed(1)}%`
                });
            }

            // Front performance analysis
            const frentesPerformance = frentes.map(frente => {
                const frenteData = filteredData.filter(entry => entry.frenteSaida === frente);
                const validData = frenteData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const avg = validData.length > 0 ? validData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validData.length : 0;
                return { frente, avg, count: frenteData.length };
            }).filter(f => f.count > 0).sort((a, b) => b.avg - a.avg);

            if (frentesPerformance.length > 0) {
                const worstFront = frentesPerformance[0];
                const bestFront = frentesPerformance[frentesPerformance.length - 1];
                
                if (worstFront.avg > configurations.limitePalha * 1.2) {
                    insights.push({
                        type: 'error',
                        icon: 'fas fa-road',
                        title: `Frente ${worstFront.frente} - Performance Crítica`,
                        description: `Tempo médio de ${worstFront.avg.toFixed(1)} min, ${((worstFront.avg - bestFront.avg) / bestFront.avg * 100).toFixed(1)}% acima da melhor frente`
                    });
                }

                if (bestFront.avg <= configurations.limitePalha * 0.8) {
                    insights.push({
                        type: 'success',
                        icon: 'fas fa-trophy',
                        title: `Frente ${bestFront.frente} - Excelente Performance`,
                        description: `Tempo médio de ${bestFront.avg.toFixed(1)} min, ${configurations.limitePalha * 0.8 >= bestFront.avg ? '20%' : 'significativamente'} abaixo do limite`
                    });
                }
            }

            // Efficiency insight
            const efficiency = validPalhaData.length > 0 ? (validPalhaData.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalhaData.length) * 100 : 0;
            
            if (efficiency < 70) {
                insights.push({
                    type: 'error',
                    icon: 'fas fa-chart-line',
                    title: 'Eficiência Baixa',
                    description: `Apenas ${efficiency.toFixed(1)}% dos registros atendem aos parâmetros. Revisão urgente necessária.`
                });
            } else if (efficiency >= 90) {
                insights.push({
                    type: 'success',
                    icon: 'fas fa-medal',
                    title: 'Alta Eficiência',
                    description: `${efficiency.toFixed(1)}% dos registros atendem aos parâmetros. Performance excepcional!`
                });
            }

            if (insights.length === 0) {
                insights.push({
                    type: 'info',
                    icon: 'fas fa-info-circle',
                    title: 'Performance Estável',
                    description: 'Todos os indicadores estão dentro dos parâmetros normais de operação.'
                });
            }

            container.innerHTML = insights.map(insight => `
                <div class="flex items-start p-4 bg-${getInsightColor(insight.type)}-50 dark:bg-${getInsightColor(insight.type)}-900/20 border border-${getInsightColor(insight.type)}-200 dark:border-${getInsightColor(insight.type)}-800 rounded-2xl">
                    <div class="flex-shrink-0 mr-4">
                        <div class="w-12 h-12 rounded-full bg-gradient-to-r from-${getInsightColor(insight.type)}-500 to-${getInsightColor(insight.type)}-600 flex items-center justify-center">
                            <i class="${insight.icon} text-white"></i>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-lg font-bold text-${getInsightColor(insight.type)}-700 dark:text-${getInsightColor(insight.type)}-300 mb-2">${insight.title}</h4>
                        <p class="text-${getInsightColor(insight.type)}-600 dark:text-${getInsightColor(insight.type)}-400 text-sm leading-relaxed">${insight.description}</p>
                    </div>
                </div>
            `).join('');
        }

        function getInsightColor(type) {
            const colors = {
                'success': 'green',
                'warning': 'yellow',
                'error': 'red',
                'info': 'blue'
            };
            return colors[type] || 'gray';
        }

        function generateRecommendations(filteredData) {
            const container = document.getElementById('recommendations-content');
            
            const recommendations = [];
            
            // Performance-based recommendations
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const avgPalha = validPalhaData.length > 0 ? validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length : 0;
            
            if (avgPalha > configurations.limitePalha) {
                recommendations.push({
                    priority: 'high',
                    category: 'Operacional',
                    title: 'Otimizar Processo de Carregamento',
                    actions: [
                        'Revisar procedimentos de carregamento na palha',
                        'Verificar capacitação dos operadores',
                        'Analisar gargalos no processo',
                        'Implementar melhorias na logística'
                    ]
                });
            }

            // Front-specific recommendations
            const frentesPerformance = frentes.map(frente => {
                const frenteData = filteredData.filter(entry => entry.frenteSaida === frente);
                const validData = frenteData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const avg = validData.length > 0 ? validData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validData.length : 0;
                return { frente, avg, count: frenteData.length };
            }).filter(f => f.count > 0 && f.avg > configurations.limitePalha * 1.1);

            if (frentesPerformance.length > 0) {
                recommendations.push({
                    priority: 'medium',
                    category: 'Infraestrutura',
                    title: 'Melhorar Frentes com Baixa Performance',
                    actions: [
                        `Focar nas frentes: ${frentesPerformance.map(f => f.frente).join(', ')}`,
                        'Verificar condições das estradas de acesso',
                        'Analisar layout e organização dos pontos de carga',
                        'Implementar sinalização e orientações específicas'
                    ]
                });
            }

            // Data quality recommendations
            const invalidData = filteredData.filter(entry => entry.tempoPalha <= 0 || entry.tempoUsina <= 0);
            if (invalidData.length > filteredData.length * 0.1) {
                recommendations.push({
                    priority: 'medium',
                    category: 'Qualidade de Dados',
                    title: 'Melhorar Qualidade dos Registros',
                    actions: [
                        'Treinar equipe para registro correto de dados',
                        'Implementar validações automáticas',
                        'Revisar processo de coleta de informações',
                        'Criar checklist de verificação'
                    ]
                });
            }

            // Efficiency recommendations
            const efficiency = validPalhaData.length > 0 ? (validPalhaData.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalhaData.length) * 100 : 0;
            
            if (efficiency >= 85) {
                recommendations.push({
                    priority: 'low',
                    category: 'Melhoria Contínua',
                    title: 'Manter Excelência Operacional',
                    actions: [
                        'Documentar e padronizar melhores práticas',
                        'Implementar programa de reconhecimento',
                        'Expandir práticas eficientes para outras áreas',
                        'Monitorar continuamente os indicadores'
                    ]
                });
            }

            if (recommendations.length === 0) {
                recommendations.push({
                    priority: 'low',
                    category: 'Monitoramento',
                    title: 'Continuar Monitoramento Ativo',
                    actions: [
                        'Manter acompanhamento regular dos indicadores',
                        'Buscar oportunidades de otimização',
                        'Implementar melhorias incrementais',
                        'Revisar metas e objetivos periodicamente'
                    ]
                });
            }

            container.innerHTML = recommendations.map(rec => `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-lg">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <div class="flex items-center mb-2">
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${getPriorityColor(rec.priority)}">
                                    ${getPriorityText(rec.priority)}
                                </span>
                                <span class="ml-2 text-sm text-gray-500 dark:text-gray-400">${rec.category}</span>
                            </div>
                            <h4 class="text-lg font-bold text-gray-900 dark:text-white">${rec.title}</h4>
                        </div>
                        <div class="text-2xl">
                            ${getPriorityIcon(rec.priority)}
                        </div>
                    </div>
                    <ul class="space-y-2">
                        ${rec.actions.map(action => `
                            <li class="flex items-start text-sm text-gray-600 dark:text-gray-400">
                                <i class="fas fa-chevron-right text-indigo-500 mr-2 mt-1 flex-shrink-0"></i>
                                <span>${action}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');
        }

        function getPriorityColor(priority) {
            const colors = {
                'high': 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400',
                'medium': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400',
                'low': 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400'
            };
            return colors[priority] || colors.low;
        }

        function getPriorityText(priority) {
            const texts = {
                'high': 'Alta Prioridade',
                'medium': 'Média Prioridade',
                'low': 'Baixa Prioridade'
            };
            return texts[priority] || texts.low;
        }

        function getPriorityIcon(priority) {
            const icons = {
                'high': '🔴',
                'medium': '🟡',
                'low': '🟢'
            };
            return icons[priority] || icons.low;
        }

        function generateComparisonReports(filteredData) {
            generateFrontComparisonChart(filteredData);
            generateShiftAnalysisChart(filteredData);
            generateComparisonTable(filteredData);
        }

        function generateFrontComparisonChart(filteredData) {
            const ctx = document.getElementById('report-front-comparison-chart');
            if (!ctx) return;

            // Destroy existing chart
            if (charts.reportFrontComparison) {
                charts.reportFrontComparison.destroy();
            }

            const comparisonData = frentes.map(frente => {
                const frenteData = filteredData.filter(entry => entry.frenteSaida === frente);
                const validPalha = frenteData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const efficiency = validPalha.length > 0 ? (validPalha.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalha.length) * 100 : 0;
                
                return {
                    frente,
                    trips: frenteData.length,
                    efficiency: efficiency,
                    avgTime: validPalha.length > 0 ? validPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalha.length : 0
                };
            }).filter(item => item.trips > 0);

            charts.reportFrontComparison = new Chart(ctx.getContext('2d'), {
                type: 'radar',
                data: {
                    labels: comparisonData.map(d => d.frente),
                    datasets: [
                        {
                            label: 'Eficiência (%)',
                            data: comparisonData.map(d => d.efficiency),
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#3B82F6'
                        },
                        {
                            label: 'Viagens (normalizado)',
                            data: comparisonData.map(d => (d.trips / Math.max(...comparisonData.map(x => x.trips))) * 100),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#10B981'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function generateShiftAnalysisChart(filteredData) {
            const ctx = document.getElementById('report-shift-analysis-chart');
            if (!ctx) return;

            // Destroy existing chart
            if (charts.reportShiftAnalysis) {
                charts.reportShiftAnalysis.destroy();
            }

            const shifts = {
                'A (6h-14h)': filteredData.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 6 && hour < 14;
                }),
                'B (14h-22h)': filteredData.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 14 && hour < 22;
                }),
                'C (22h-6h)': filteredData.filter(entry => {
                    const hour = new Date(entry.saidaCentral).getHours();
                    return hour >= 22 || hour < 6;
                })
            };

            const shiftData = Object.keys(shifts).map(shift => {
                const shiftEntries = shifts[shift];
                const validPalha = shiftEntries.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const avgTime = validPalha.length > 0 ? validPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalha.length : 0;
                const efficiency = validPalha.length > 0 ? (validPalha.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalha.length) * 100 : 0;
                
                return {
                    shift,
                    avgTime,
                    efficiency,
                    count: shiftEntries.length
                };
            });

            charts.reportShiftAnalysis = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: shiftData.map(d => d.shift),
                    datasets: [
                        {
                            label: 'Tempo Médio (min)',
                            data: shiftData.map(d => d.avgTime.toFixed(1)),
                            backgroundColor: '#8B5CF6',
                            borderColor: '#7C3AED',
                            borderWidth: 2,
                            borderRadius: 8,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Eficiência (%)',
                            data: shiftData.map(d => d.efficiency.toFixed(1)),
                            type: 'line',
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.2)',
                            borderWidth: 3,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Tempo (minutos)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Eficiência (%)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        function generateComparisonTable(filteredData) {
            const tbody = document.getElementById('comparison-table-body');
            
            const tableData = frentes.map(frente => {
                const frenteData = filteredData.filter(entry => entry.frenteSaida === frente);
                const validPalha = frenteData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const validUsina = frenteData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 60);
                
                const avgPalha = validPalha.length > 0 ? validPalha.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalha.length : 0;
                const avgUsina = validUsina.length > 0 ? validUsina.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsina.length : 0;
                
                const efficiency = validPalha.length > 0 ? (validPalha.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalha.length) * 100 : 0;
                
                return {
                    frente,
                    trips: frenteData.length,
                    avgPalha,
                    avgUsina,
                    efficiency
                };
            }).filter(item => item.trips > 0);

            tbody.innerHTML = tableData.map(row => `
                <tr class="table-row-modern">
                    <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">${row.frente}</td>
                    <td class="px-4 py-3 text-sm text-center text-gray-900 dark:text-white">${row.trips}</td>
                    <td class="px-4 py-3 text-sm text-center text-gray-900 dark:text-white">${row.avgPalha.toFixed(1)} min</td>
                    <td class="px-4 py-3 text-sm text-center text-gray-900 dark:text-white">${row.avgUsina.toFixed(1)} min</td>
                    <td class="px-4 py-3 text-sm text-center text-gray-900 dark:text-white">${row.efficiency.toFixed(1)}%</td>
                    <td class="px-4 py-3 text-center">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(row.efficiency)}">
                            ${getStatusText(row.efficiency)}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusColor(efficiency) {
            if (efficiency >= 85) return 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400';
            if (efficiency >= 70) return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400';
            return 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400';
        }

        function getStatusText(efficiency) {
            if (efficiency >= 85) return 'Excelente';
            if (efficiency >= 70) return 'Bom';
            return 'Crítico';
        }

        function generatePerformanceReports(filteredData) {
            generatePerformanceGauge(filteredData);
            generateTopPerformers(filteredData);
            generateImprovementAreas(filteredData);
            generatePerformanceKPIs(filteredData);
        }

        function generatePerformanceGauge(filteredData) {
            const container = document.getElementById('performance-gauge');
            
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const efficiency = validPalhaData.length > 0 ? (validPalhaData.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalhaData.length) * 100 : 0;
            
            const scoreColor = efficiency >= 85 ? 'green' : efficiency >= 70 ? 'yellow' : 'red';
            const scoreText = efficiency >= 85 ? 'Excelente' : efficiency >= 70 ? 'Bom' : 'Crítico';

            container.innerHTML = `
                <div class="relative w-40 h-40">
                    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                        <!-- Background circle -->
                        <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                        <!-- Progress circle -->
                        <circle cx="50" cy="50" r="40" stroke="${getGaugeColor(scoreColor)}" stroke-width="8" fill="none"
                                stroke-dasharray="${2 * Math.PI * 40}" 
                                stroke-dashoffset="${2 * Math.PI * 40 * (1 - efficiency / 100)}"
                                class="transition-all duration-1000 ease-out"/>
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span class="text-3xl font-bold text-gray-900 dark:text-white">${efficiency.toFixed(0)}%</span>
                        <span class="text-sm text-gray-600 dark:text-gray-400">${scoreText}</span>
                    </div>
                </div>
            `;
        }

        function getGaugeColor(color) {
            const colors = {
                'green': '#10B981',
                'yellow': '#F59E0B',
                'red': '#EF4444'
            };
            return colors[color] || colors.red;
        }

        function generateTopPerformers(filteredData) {
            const container = document.getElementById('top-performers-list');
            
            const frentesPerformance = frentes.map(frente => {
                const frenteData = filteredData.filter(entry => entry.frenteSaida === frente);
                const validData = frenteData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const efficiency = validData.length > 0 ? (validData.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validData.length) * 100 : 0;
                
                return { frente, efficiency, count: frenteData.length };
            }).filter(f => f.count > 0).sort((a, b) => b.efficiency - a.efficiency).slice(0, 3);

            container.innerHTML = frentesPerformance.map((perf, index) => `
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl">
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-sm mr-3">
                            ${index + 1}
                        </div>
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">Frente ${perf.frente}</p>
                            <p class="text-xs text-green-600 dark:text-green-400">${perf.count} viagens</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-green-700 dark:text-green-300">${perf.efficiency.toFixed(1)}%</p>
                        <p class="text-xs text-green-600 dark:text-green-400">eficiência</p>
                    </div>
                </div>
            `).join('');

            if (frentesPerformance.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 py-8">Dados insuficientes</p>';
            }
        }

        function generateImprovementAreas(filteredData) {
            const container = document.getElementById('improvement-areas-list');
            
            const frentesPerformance = frentes.map(frente => {
                const frenteData = filteredData.filter(entry => entry.frenteSaida === frente);
                const validData = frenteData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
                const avgTime = validData.length > 0 ? validData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validData.length : 0;
                
                return { frente, avgTime, count: frenteData.length };
            }).filter(f => f.count > 0 && f.avgTime > configurations.limitePalha)
              .sort((a, b) => b.avgTime - a.avgTime).slice(0, 3);

            container.innerHTML = frentesPerformance.map((perf, index) => `
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-xl">
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-r from-red-500 to-red-600 text-white font-bold text-sm mr-3">
                            !
                        </div>
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">Frente ${perf.frente}</p>
                            <p class="text-xs text-red-600 dark:text-red-400">${perf.count} viagens</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-red-700 dark:text-red-300">${perf.avgTime.toFixed(1)} min</p>
                        <p class="text-xs text-red-600 dark:text-red-400">tempo médio</p>
                    </div>
                </div>
            `).join('');

            if (frentesPerformance.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-check-circle text-green-500 text-4xl mb-4"></i>
                        <p class="text-green-600 dark:text-green-400 font-medium">Todas as frentes estão dentro dos parâmetros!</p>
                    </div>
                `;
            }
        }

        function generatePerformanceKPIs(filteredData) {
            const validPalhaData = filteredData.filter(entry => entry.tempoPalha > 0 && entry.tempoPalha <= 60);
            const validUsinaData = filteredData.filter(entry => entry.tempoUsina > 0 && entry.tempoUsina <= 60);
            
            const avgTotal = validPalhaData.length > 0 && validUsinaData.length > 0 ? 
                ((validPalhaData.reduce((sum, entry) => sum + entry.tempoPalha, 0) / validPalhaData.length) + 
                 (validUsinaData.reduce((sum, entry) => sum + entry.tempoUsina, 0) / validUsinaData.length)) : 0;
            
            const hitRate = validPalhaData.length > 0 ? (validPalhaData.filter(entry => entry.tempoPalha <= configurations.limitePalha).length / validPalhaData.length) * 100 : 0;
            
            const productivity = filteredData.length / Math.max(1, document.getElementById('report-period').value === 'all' ? 30 : parseInt(document.getElementById('report-period').value));
            
            const outliers = filteredData.filter(entry => entry.tempoPalha > configurations.limitePalha * 2 || entry.tempoUsina > configurations.limitePatio * 2).length;

            // Update performance KPIs
            document.getElementById('perf-avg-total').textContent = `${avgTotal.toFixed(1)} min`;
            document.getElementById('perf-hit-rate').textContent = `${hitRate.toFixed(1)}%`;
            document.getElementById('perf-productivity').textContent = `${productivity.toFixed(1)} /dia`;
            document.getElementById('perf-outliers').textContent = outliers.toString();

            // Update trend indicators
            document.getElementById('perf-avg-total-trend').textContent = avgTotal <= (configurations.limitePalha + configurations.limitePatio) ? 'Dentro da meta' : 'Acima da meta';
            document.getElementById('perf-hit-rate-trend').textContent = hitRate >= 85 ? 'Excelente' : hitRate >= 70 ? 'Bom' : 'Crítico';
            document.getElementById('perf-productivity-trend').textContent = productivity >= 20 ? 'Alta' : productivity >= 10 ? 'Média' : 'Baixa';
            document.getElementById('perf-outliers-trend').textContent = outliers === 0 ? 'Ótimo' : outliers <= 3 ? 'Aceitável' : 'Atenção';

            // Update trend colors
            document.getElementById('perf-avg-total-trend').className = `text-sm font-medium mt-2 ${avgTotal <= (configurations.limitePalha + configurations.limitePatio) ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('perf-hit-rate-trend').className = `text-sm font-medium mt-2 ${hitRate >= 85 ? 'text-green-600' : hitRate >= 70 ? 'text-yellow-600' : 'text-red-600'}`;
            document.getElementById('perf-productivity-trend').className = `text-sm font-medium mt-2 ${productivity >= 20 ? 'text-green-600' : productivity >= 10 ? 'text-yellow-600' : 'text-red-600'}`;
            document.getElementById('perf-outliers-trend').className = `text-sm font-medium mt-2 ${outliers === 0 ? 'text-green-600' : outliers <= 3 ? 'text-yellow-600' : 'text-red-600'}`;
        }

        function exportReportToPDF() {
            showToast('Funcionalidade em desenvolvimento', 'info');
        }

        // Tornar função global para ser chamada pelo onclick
        window.removeFrente = removeFrente;
        window.validateAndClearAll = validateAndClearAll;
        window.createDynamicReportSections = createDynamicReportSections;

        // Initialize reports listeners when document is ready
        document.addEventListener('DOMContentLoaded', function() {
            setupReportsListeners();
        });
    </script>
</body>
</html>
